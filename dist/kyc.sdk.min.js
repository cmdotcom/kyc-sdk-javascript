"use strict";!function(){window.console&&"undefined"!=typeof console||(console=console||{},["assert","clear","count","error","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","trace","warn"].map(function(e){console[e]=function(){}}));var s,c,b,i,e,d=!1,t="kyc_sdk",l="0.0.1",x={},n=new Date,a=function(t){t&&"string"==typeof t&&(t={url:t.trim()}),t.method=t.method||"GET";var n,c=function(e){t.callback&&"function"==typeof t.callback&&t.callback(e)},i=new XMLHttpRequest,e=t.params;try{i.open(t.method,t.url)}catch(e){return void c({error:e,xhr:i})}if(i.withCredentials=t.withCredentials||!1,i.addEventListener("load",function(){if(console.log(i),4==i.readyState)if(200<=i.status&&i.status<300){try{n=JSON.parse(i.response||i.responseText)}catch(e){n=i.response||i.responseText}c({success:n,xhr:i})}else c({error:"invalid http status",xhr:i})}),i.addEventListener("error",function(){c({error:"invalid http status",xhr:i})}),t.headers)for(var a in t.headers)i.setRequestHeader(a,t.headers[a]);if("GET"==t.method&&t.params&&"object"==typeof t.params){for(var a in e=[],t.params)e.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));e=e.join("&")}try{i.send(e)}catch(e){c({error:e,xhr:i})}},w=function(e){e.headers={Authorization:"Bearer "+i.userToken},a(e)},u=function(n){if(i&&i.userToken)o(n);else{var e={url:c,method:"POST",withCredentials:!0,headers:{"Content-Type":"application/json;charset=UTF-8"},params:JSON.stringify({clientId:n.kyc.context.clientId,templateId:n.kyc.context.templateId,customerName:n.kyc.context.customerName,externalReference:n.kyc.context.externalReference,firstName:n.kyc.context.firstName,lastName:n.kyc.context.lastName,msisdn:n.kyc.context.msisdn,userIdentifier:n.kyc.context.userIdentifier}),callback:function(e){if(e.success)f("login",n),(i=e.success).data=function(e){try{var t=e.split(".")[0].replace("-","+").replace("_","/"),n=JSON.parse(window.atob(t)),c=e.split(".")[1].replace("-","+").replace("_","/"),i=JSON.parse(window.atob(c));return i.header=n,i}catch(e){return!1}}(i.userToken),o(n);else{var t="No kyc Token could be retrieved from "+c+"!";f("error",n,{error:{message:t,object:e}}),console.warn(t,e)}}};a(e)}},o=function(t){w({url:b+"/api/v1/users/me",callback:function(e){if(e.success)t.kyc.status.changed=new Date,t.kyc.context.firstName=e.success.firstName,t.kyc.context.lastName=e.success.lastName,t.kyc.context.msisdn=e.success.msisdn,f("identification",t),r(t);else{f("error",t,{error:{message:"KYC identity could not be verified!",object:e}}),console.warn("KYC identity could not be verified!",e.error)}}})},r=function(t){var e={url:b+"/api/v1/users/"+i.data.uuid+"/dossiers",callback:function(e){e.success?(t.kyc.status.changed=new Date,t.kyc.dossiers=((e.success.filter(function(e){return!0})||[]).map(function(e){return e.dossiers}).shift()||[]).filter(function(e){return!0}),f("dossiers",t),0<t.kyc.dossiers.length&&E(t)):console.warn("KYC dossiers could not be fetched!",e.error)}};w(e)},y=function(e,t){if(!window.kyc_config)return d&&console.warn("No kyc_config object found on window!"),!1;if(!window.kyc_config.authorisationEndPoint)return d&&console.warn("No kyc authorisationEndPoint on the kyc_config object!"),!1;if(!window.kyc_config.kycApiEndPoint)return d&&console.warn("No kyc kycApiEndPoint on the kyc_config object!"),!1;if(c=window.kyc_config.authorisationEndPoint,b=window.kyc_config.kycApiEndPoint,!t){if(!window.kyc_config.context)return d&&console.warn("No context object found on the kyc_config object!"),!1;t=window.kyc_config.context}if(!e){if(!window.kyc_config.elementId)return d&&console.warn("No elementId object found on the kyc_config object!"),!1;e=window.kyc_config.elementId}return e?document.getElementById(e)?{element:document.getElementById(e),context:JSON.parse(JSON.stringify(t))}:e?void 0:(d&&console.warn("The HTML element with id '"+e+"'  is not present in the DOM tree!"),!1):(d&&console.warn("No elementId is given!"),!1)},k=function(e,t){var n;return"function"==typeof Event?n=new Event(e):(n=document.createEvent("Event")).initEvent(e,!0,!0),t&&(n.detail=t),n},g=function(e){return e=e||"",window.kyc_config&&window.kyc_config.translate&&"function"==typeof window.kyc_config.translate?window.kyc_config.translate(e):e},f=function(t,e,n){var c;t&&"string"==typeof t&&e&&e.kyc&&(t=k(t.trim(),n||p(e)));try{c=JSON.parse(JSON.stringify(t))}catch(e){return void console.log(e,t,typeof t)}c.isTrusted=!0,c.type=t.type.toString(),e?function(e,t){if(e!=window&&(e.kyc.eventType=t),"createEvent"in document){var n=document.createEvent("HTMLEvents");return n.initEvent("load",!1,!0),n.kyctype=t,e.dispatchEvent(n)}e.fireEvent("onload")}(c.target=e,c.type):c.target="kyc_sdk",window.kyc_config&&window.kyc_config.onEvent&&"function"==typeof window.kyc_config.onEvent?window.kyc_config.onEvent(c):d&&console.warn("No onEvent function found on the kyc_config object!",{event:c})},A=function(e,t){var n=t||s,c=n.querySelector(e);return c?c.cloneNode(!0):(console.warn("A templating error has occured.!",{selector:e,template:n.innerHTML}),null)},S=function(e){e.innerHTML="";var t=A("[data-kyc-loader]",e.kyc.template);t&&e.appendChild(t),e.setAttribute("kyc-sdk-status","loading")},E=function(a){try{var e=A("[data-kyc-dossier-list]",a.kyc.template),o=e.querySelector("[data-kyc-dossier-item]"),r=(Array.prototype,o);a.kyc.dossiers.map(function(t){var e=o.cloneNode(!0),n=e.querySelector("kyc-dossier-name"),c=e.querySelector("kyc-dossier-status"),i=e.querySelector("kyc-dossier-created");e.setAttribute("data-kyc-status",t.status),n&&n.parentNode.replaceChild(document.createTextNode(t.customerName),n),c&&c.parentNode.replaceChild(document.createTextNode(g(t.status)),c),i&&i.parentNode.replaceChild(document.createTextNode(function(e){if(window.kyc_config&&window.kyc_config.formatDate&&"function"==typeof window.kyc_config.formatDate)return window.kyc_config.formatDate(e)}(new Date(t.createdAt))),i),r.parentNode.insertBefore(e,r.nextSibling),e.addEventListener("click",function(e){S(a),a.kyc.history.back=[],a.kyc.history.next=[],function(t,n){var c=t.kyc.dossiers.filter(function(e){return e.id==n}).shift();if(c)return c.tasks?C(t,c):w({url:b+"/api/v1/dossiers/"+n+"/tasks",callback:function(e){e.success?(c.tasks=e.success,C(t,c)):console.warn("KYC dossier tasks could not be fetched!",e.error)}});console.warn("KYC dossier could not be fetched!")}(a,t.id)}),r=e}),o.parentNode.removeChild(o),a.innerHTML="",a.appendChild(e),a.setAttribute("kyc-sdk-status","dossiers")}catch(e){return void console.warn("A templating error has occured while building the dossier list!",e)}},C=function(i,a){try{var e=A("[data-kyc-task-list]",i.kyc.template),t=e.querySelector("[data-kyc-dossier-title] kyc-text"),o=e.querySelector("[data-kyc-task-item]"),n=e.querySelector("[data-kyc-to-dossiers]"),c=Array.prototype,r=o;t&&t.parentNode.replaceChild(document.createTextNode(a.customerName),t),c.slice.call(n.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g("Back")),e)}),n.addEventListener("click",function(){E(i)}),a.tasks.map(function(t){var e=o.cloneNode(!0),n=e.querySelector("kyc-task-name"),c=e.querySelector("kyc-task-status");e.setAttribute("data-kyc-status",t.status),n&&n.parentNode.replaceChild(document.createTextNode(t.name),n),c&&c.parentNode.replaceChild(document.createTextNode(g(t.status)),c),r.parentNode.insertBefore(e,r.nextSibling),e.addEventListener("click",function(e){S(i),i.kyc.history.back=[],i.kyc.history.next=[],function(t,n,c){var i,a;if((i=t.kyc.dossiers.filter(function(e){return e.id==n}).map(function(e){return e}).shift())&&i.tasks&&(a=i.tasks.filter(function(e){return e.id==c}).shift()))return a.checks?T(t,i,a):w({url:b+"/api/v1/tasks/"+c,callback:function(e){e.success?(a=e.success,setTimeout(function(){T(t,i,a)},1e3)):console.warn("KYC dossier tasks could not be fetched!",e.error)}});console.warn("KYC dossier could not be fetched!")}(i,a.id,t.id)}),r=e}),o.parentNode.removeChild(o),i.innerHTML="",i.appendChild(e),i.setAttribute("kyc-sdk-status","tasks")}catch(e){return void console.warn("A templating error has occured while building the dossier task list!",e)}},T=function(n,t,c,i){i=i||c.sequence.initialCheckId;var a=c.checks.filter(function(e){return e.id==i}).shift();if(a&&a.id){var o=c.sequence.transitions.filter(function(e){return e.from==i}).map(function(e){return e.defaultGoTo}).shift();try{var e=A("[data-kyc-dossier]",n.kyc.template),r=Array.prototype;r.slice.call(e.querySelectorAll("[name]")).map(function(e){e.removeAttribute("name")});var s,d=e.querySelector("[data-kyc-dossier-title] kyc-text"),l=(e.querySelector(" [data-kyc-dossier-tasks-navigation]"),e.querySelector("[data-kyc-task]")),u=l.querySelector("[data-kyc-task-title] kyc-text"),y=l.querySelector("[data-kyc-check]"),k=(l.querySelector("[data-kyc-task-navigation]"),a.id.trim());d&&d.parentNode.replaceChild(document.createTextNode(t.customerName),d),u&&u.parentNode.replaceChild(document.createTextNode(c.name),u);var f=y.cloneNode(!0),p=f.querySelector("kyc-input");switch(r.slice.call(f.querySelectorAll("kyc-check-description")).map(function(e){a.definition.description?e.parentNode.replaceChild(document.createTextNode(g(a.definition.description)),e):e.parentNode.removeChild(e)}),r.slice.call(f.querySelectorAll("kyc-check-longdescription")).map(function(e){a.definition.longDescription?e.parentNode.replaceChild(document.createTextNode(g(a.definition.longDescription)),e):e.parentNode.removeChild(e)}),a.definition.method&&f.setAttribute("data-kyc-method",a.definition.method||null),a.definition.valueFormat&&f.setAttribute("data-kyc-valueformat",a.definition.valueFormat||null),a.definition.method){case"MANUAL_SINGLE_CHOICE_ENUM":case"MANUAL_MULTIPLE_CHOICE_ENUM":switch(s=p.querySelector("[data-kyc-options]").cloneNode(!1),a.definition.method){case"MANUAL_SINGLE_CHOICE_ENUM":if(a.definition.enumSpecification.length<4)(a.definition.enumSpecification||[]).map(function(t){var e=p.querySelector("[data-kyc-radiobutton]").cloneNode(!0),n=e.querySelector("[data-kyc-radio-input]");n.setAttribute("type","radio"),n.setAttribute("name",k),n.setAttribute("value",t.name),n.value=t.name,n.checked=!!a.value&&t.name.trim()===a.value.trim(),r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g(t.explanation?t.explanation:t.name)),e)}),s.appendChild(e)});else{s=p.querySelector("[data-kyc-select-input]").cloneNode(!1);var m=(p.querySelector("[data-kyc-select-input]").querySelector("option")||document.createElement("option")).cloneNode(!1);s.setAttribute("name",k),a.value||(m.value="",m.innerHTML=g("select an option"),s.appendChild(m)),(a.definition.enumSpecification||[]).map(function(e){(m=m.cloneNode(!0)).value=e.name,m.selected=!!a.value&&e.name.trim()===a.value.trim(),m.innerHTML=g(e.explanation?e.explanation:e.name),s.appendChild(m)})}break;case"MANUAL_MULTIPLE_CHOICE_ENUM":k=a.id.trim()+"[]",(a.definition.enumSpecification||[]).map(function(t){var e=p.querySelector("[data-kyc-checkbox]").cloneNode(!0),n=e.querySelector("[data-kyc-checkbox-input]");n.setAttribute("type","checkbox"),n.setAttribute("name",k),n.setAttribute("value",t.name),n.checked=!!a.value&&0<JSON.parse(a.value||"[]").filter(function(e){return e.trim()==t.name.trim()}).length,r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g(t.explanation?t.explanation:t.name)),e)}),s.appendChild(e)})}break;default:switch(a.definition.method){case"MANUAL_TEXT_INPUT":case"MANUAL_DATE_INPUT":switch(a.definition.valueFormat){case"LONG_TEXT":(s=p.querySelector("[data-kyc-textarea]").cloneNode(!0)).setAttribute("placeholder",g(a.definition.description)),s.value=a.value||null,s.setAttribute("name",k);break;default:switch(s=p.querySelector("[data-kyc-input]").cloneNode(!0),a.definition.valueFormat){case"NATURAL_NUMBER":case"REAL_NUMBER":s.setAttribute("type","number"),"NATURAL_NUMBER"==a.definition.valueFormat&&(s.setAttribute("step",1),s.setAttribute("min",0));break;case"EMAIL":s.setAttribute("type","email");break;case"URL":s.setAttribute("type","url");break;case"PHONE_NUMBER":case"IBAN":s.setAttribute("type","tel");break;default:s.setAttribute("type","text")}s.setAttribute("placeholder",g(a.definition.description)),s.setAttribute("name",a.id),s.value=a.value||null}break;case"IDIN":(s=document.createElement("div")).setAttribute("class",p.querySelector("[data-kyc-input]").getAttribute("class")),s.innerHTML="IDIN is coming soon to the web flow";break;case"RAW_DOCUMENT_SCAN":case"DOCUMENT_FILE_UPLOAD":case"SELFIE_CHECK":var h=(s=p.querySelector("[data-kyc-file]").cloneNode(!0)).querySelector("[data-kyc-file-input]"),v=(p.querySelector("kyc-placeholder"),s.querySelector("[data-kyc-file-preview]"));if(h.setAttribute("type","file"),h.setAttribute("placeholder",g(a.definition.description)),v.innerHTML=g(a.definition.description),h.addEventListener("change",function(e){if(e.target.files&&e.target.files[0]){var t=new FileReader;t.onload=function(e){console.log(e)},t.readAsDataURL(e.target.files[0])}console.log(e)}),a.value)if(x[a.value])v.setAttribute("style",'background-image:url("'+x[a.value]+'")');else{var N={url:b+"/api/v1/uploads/"+a.value,method:"POST",callback:function(e){e.success?(x[a.value]=e.success,v.setAttribute("style",'background-image:url("'+x[a.value]+'")')):console.warn("No upload with the id "+a.value+" could be retrieved!",e.error)}};w(N)}}}p.parentNode.replaceChild(s,p),y.parentNode.replaceChild(f,y),r.slice.call(e.querySelectorAll("[data-kyc-to-dossiers]")).map(function(e){r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g("Back")),e)}),e.addEventListener("click",function(){E(n)})}),r.slice.call(e.querySelectorAll("[data-kyc-to-tasks]")).map(function(e){r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g("Back")),e)}),e.addEventListener("click",function(){C(n,t)})}),0<n.kyc.history.back.length?r.slice.call(e.querySelectorAll("[data-kyc-task-previous]")).map(function(e){r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g("Back")),e)}),e.addEventListener("click",function(){var e,t;(t=(e=n).kyc.history.back.pop())&&(e.kyc.history.next.push(t),"function"==typeof t&&t())})}):r.slice.call(e.querySelectorAll("[data-kyc-task-navigation] [data-kyc-task-previous]")).map(function(e){e.parentNode.removeChild(e)}),r.slice.call(e.querySelectorAll("[data-kyc-task-next]")).map(function(e){r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g("Next")),e)}),e.addEventListener("click",function(){var e=n.querySelector("form");if(e&&(a.value=k==a.id?(e.querySelector('[name="'+k+'"]')||{value:""}).value||"":JSON.stringify(r.slice.call(e.querySelectorAll('[name="'+k+'"]')).map(function(e){return e.value||""}))),o)return S(n),n.kyc.history.back.push(function(){S(n),T(n,t,c,a.id)}),void T(n,t,c,o);S(n),n.kyc.history.back.push(function(){S(n),T(n,t,c,a.id)}),C(n,t)})}),n.innerHTML="",n.appendChild(e),n.setAttribute("kyc-sdk-status","task")}catch(e){console.warn("A templating error has occured while building the dossier task check form!",e)}}else console.warn("The check could not be determined!")},p=function(e){return{context:e.kyc.context,status:e.kyc.status}},m=function(e,t){var n,c,i,a,o=document.createElement("kyc-view"),r=y(e,t);return!!r&&(d=!0,c=r.element,i=r.context,c.kyc?(c.setAttribute("kyc-sdk-status","ready"),c.kyc.status.reset=new Date,c.kyc.context=i,a=k("reset",p(c))):(n={initialised:new Date,version:l},a=k("initialised",{status:n,context:i}),c.kyc={context:r.context,status:n,template:function(e){s=document.createElement("kyc-template");var t=document.createElement("kyc-custom-template"),n=document.createElement("kyc-default-template");return n.innerHTML='/*\x3c!-- Define the template for the dossier-list --\x3e<div data-kyc-dossier-list><div data-kyc-dossier-item><kyc-dossier-name></kyc-dossier-name><kyc-dossier-status></kyc-dossier-status><kyc-dossier-created></kyc-dossier-created></div></div><div data-kyc-task-list><h1 data-kyc-dossier-title><kyc-text></kyc-text></h1><div data-kyc-task-list><kyc-task-name></kyc-task-name><kyc-task-status></kyc-task-status></div></div>\x3c!-- Define the template for a single dossier --\x3e<div data-kyc-dossier><h1 data-kyc-dossier-title><kyc-text></kyc-text></h1><div data-kyc-dossier-tasks-navigation></div>\x3c!-- Define the template for a single task in a dossier --\x3e<form data-kyc-task><h2 data-kyc-task-title><kyc-text></kyc-text></h2>\x3c!-- Define the template for a single check in a task in a dossier --\x3e<div data-kyc-check><label><kyc-check-description></kyc-check-description></label><kyc-input><input data-kyc-input class="form-control"> <textarea data-kyc-textarea class="form-control"></textarea> <label data-kyc-checkbox><input type="checkbox"><kyc-text></kyc-text></label> <label data-kyc-radiobutton><input type="radio"><kyc-text></kyc-text></label><div data-kyc-file><div data-kyc-file-preview></div><input data-kyc-file-input></div></kyc-input><small><kyc-check-longdescription></kyc-check-longdescription></small></div>\x3c!-- Define the template the navigation between tasks in a dossier --\x3e<div data-kyc-task-navigation><button type="button" data-kyc-task-previous><kyc-text></kyc-text></button> <button type="button" data-kyc-task-next><kyc-text></kyc-text></button></div></form></div>\x3c!-- Define the template the loader --\x3e<cm-indicator data-kyc-loader></cm-indicator>*/',t.innerHTML=e,s.appendChild(t),s.appendChild(n),s.cloneNode(!0)}(c.innerHTML.trim()),history:{back:[],next:[]}},c.setAttribute("kyc-sdk-status","ready"),S(c),c.appendChild(o)),f(a,c),u(c),c)};if(!window[t]){window[t]={get initialised(){return n},get version(){return l},init:m};var h=k("ready",{status:{initialised:n,version:l}});f(h,window),d=!0,e=function(){y()&&m()},"loading"!=document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"loading"!=document.readyState&&e()})}}();