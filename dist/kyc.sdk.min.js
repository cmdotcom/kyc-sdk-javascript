"use strict";!function(){window.console&&"undefined"!=typeof console||(console=console||{},["assert","clear","count","error","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","trace","warn"].map(function(e){console[e]=function(){}}));var d,a,T,E,D,e,l=!1,t="kyc_sdk",u="0.0.1",i=JSON.parse(JSON.stringify(window.location)),q={},_={IDIN:null,IBAN:null},n=new Date,L=Array.prototype,r=function(t){t&&"string"==typeof t&&(t={url:t.trim()}),t.method=t.method||"GET";var i,n=function(e){t.callback&&"function"==typeof t.callback&&t.callback(e)},a=new XMLHttpRequest,e=t.params;try{a.open(t.method,t.url)}catch(e){return void n({error:e,xhr:a})}if(a.withCredentials=t.withCredentials||!1,a.addEventListener("load",function(){if(4==a.readyState)if(200<=a.status&&a.status<300){try{i=JSON.parse(a.response||a.responseText)}catch(e){i=a.response||a.responseText}n({success:i||"OK",xhr:a})}else{try{i=JSON.parse(a.response||a.responseText)}catch(e){i="invalid http status"}n({error:i||"ERROR",xhr:a})}}),a.addEventListener("error",function(){n({error:"invalid http status",xhr:a})}),t.headers)for(var r in t.headers)a.setRequestHeader(r,t.headers[r]);if("GET"==t.method&&t.params&&"object"==typeof t.params){for(var r in e=[],t.params)e.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));e=e.join("&")}try{a.send(e)}catch(e){n({error:e,xhr:a})}},M=function(e){e.headers={Authorization:"Bearer "+E.userToken},r(e)},U=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i="",n=(new Date).valueOf().toString().split("");i.length<e;)0<n.length?i+=t.charAt(Math.floor(Math.max(t.length,parseInt(n.shift()+" "+n.shift())))):i+=t.charAt(Math.floor(Math.random()*t.length));return i},c=function(e,t){var i=function(e){return e.split("").map(function(e){return e.charCodeAt(0)})};i(t);return((e||"").match(/.{1,2}/g)||[]).map(function(e){return parseInt(e,16)}).map(function(e){return i(t).reduce(function(e,t){return e^t},e)}).map(function(e){return String.fromCharCode(e)}).join("")},o=function(e,t,i){i||(i=new Date).setTime(i.getTime()+9e6),document.cookie=e+"="+t+";expires="+i.toUTCString()+";path=/"},s=function(e){var t;return"undefined"!=typeof Storage?sessionStorage.KYCStorage&&(t=JSON.parse(c(sessionStorage.KYCStorage||"",e))):t=JSON.parse(c(function(e){for(var t=e+"=",i=decodeURIComponent(document.cookie).split(";"),n=0;n<i.length;n++){for(var a=i[n];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null}("KYCStorage")||"",e)),t&&t instanceof Object?t:null},k=function(e,t){var i,n,a,r=(i=JSON.stringify(t),n=e,a=function(e){return e.split("").map(function(e){return e.charCodeAt(0)})},i.split("").map(a).map(function(e){return a(n).reduce(function(e,t){return e^t},e)}).map(function(e){return("0"+Number(e).toString(16)).substr(-2)}).join(""));"undefined"!=typeof Storage?sessionStorage.KYCStorage=r:o("KYCStorage",r)},f=function(){if(D)return D;var a={};if(i&&i.search){i.search.substr(1).split("&").map(function(e){if(1<(e=e.split("=")).length){var t=e.shift();if("trxid"==t&&(D=D||{},a.IDIN={transactionId:e.join("=").trim()}),"kycs_"==t.split("kycs_").shift()&&2==t.split("kycs_").length){var i=s(t.split("kycs_").pop().trim());if(i)for(var n in i)"KYCToken"==n?E=i[n]:(D=D||{})[n]=i[n]}}return!1});D&&D.IDIN&&D.IDIN.transactionId&&a.IDIN&&a.IDIN.transactionId&&!!a.IDIN.transactionId==!!D.IDIN.transactionId?K(D.IDIN.transactionId,function(e){e&&(D.IDIN=e)}):delete D.IDIN}return D},p=function(i){if(E&&E.userToken){if(!i){var e=H("getToken",{KYCToken:E});return void J(e,window)}y(i)}else{var t=i||window;if(!(t&&(t.kyc&&t.kyc.context||t.kyc_config&&t.kyc_config.context)))return void P("No kyc config found","getToken",{description:"invalid KYC configuration"},{config:t?t.kyc_config||t.kyc:null},i);var n={url:a,method:"POST",withCredentials:!0,headers:{"Content-Type":"application/json;charset=UTF-8"},params:JSON.stringify({clientId:(t.kyc_config||t.kyc).context.clientId,templateId:(t.kyc_config||t.kyc).context.templateId,customerName:(t.kyc_config||t.kyc).context.customerName,externalReference:(t.kyc_config||t.kyc).context.externalReference,firstName:(t.kyc_config||t.kyc).context.firstName,lastName:(t.kyc_config||t.kyc).context.lastName,msisdn:(t.kyc_config||t.kyc).context.msisdn,userIdentifier:(t.kyc_config||t.kyc).context.userIdentifier}),callback:function(e){if(e.success){if((E=e.success).data=function(e){try{var t=e.split(".")[0].replace("-","+").replace("_","/"),i=JSON.parse(window.atob(t)),n=e.split(".")[1].replace("-","+").replace("_","/"),a=JSON.parse(window.atob(n));return a.header=i,a}catch(e){return!1}}(E.userToken),!i){var t=H("getToken",{KYCToken:E});return void J(t,window)}J("login",i),y(i)}else P("No kyc Token could be retrieved from "+a+"!","getToken",e,{authorisationEndPoint:a},i)}};r(n)}},y=function(r){M({url:T+"/api/v1/users/me",callback:function(e){if(e.success){if(r)return r.kyc.status.changed=new Date,r.kyc.context.firstName=e.success.firstName,r.kyc.context.lastName=e.success.lastName,r.kyc.context.msisdn=e.success.msisdn,r.kyc.context.userIdentifier=e.success.id,J("identification",r),void m(r);var t=H("me",{me:e.success});J(t,window)}else{var i="KYC identity could not be verified!";if(console.warn(i,e.error),r){var n=b(r);n.action="getMe",n.message=i,n.error=e.error,J("error",r,n)}else{var a=H("error",{action:"getMe",message:i,error:e.error});J(a,window)}}}})},O=function(e,t,i){var n=location.search.substring(1).split("&").filter(function(e){return-1===["trxid","ec"].indexOf(e.toLowerCase().split("=").shift()||"")&&!("kycs_"==(e.toLowerCase().split("=").shift()||"").split("kycs_").shift()&&2==(e.toLowerCase().split("=").shift()||"").split("kycs_").length)}).join("&").trim(),a=i instanceof String?i:i.returnUrl||location.origin+location.pathname+location.hash+!!n?"?"+n+(i.KYCSECRET&&i.KYCStorage?"&kycs_"+i.KYCsecret+"=1":""):i.KYCSECRET&&i.KYCStorage?"?kycs_"+i.KYCSECRET+"=1":"";M({url:T+"/api/v1/identityservices/idin/transaction",method:"POST",params:{issuerId:e,idinKeys:t,merchantReturnUrl:a},callback:function(e){if(e.success&&e.issuerAuthenticationUrl)return i instanceof Object&&i.KYCSECRET&&i.KYCStorage&&e.transaction_id&&(i.KYCStorage.IDIN={transactionId:e.transactionId,issuerAuthenticationUrl:e.issuerAuthenticationUrl},k(i.KYCSECRET,i.KYCStorage)),void window.location.replace(e.issuerAuthenticationUrl);P("KYC could retrieve IDIN AuthenticationUrl","getIdinIssuers",e.error||{error:e.success})}})},K=function(e,i){M({url:T+"/api/v1/identityservices/idin/transaction/transactionId",callback:function(e){if(e.success){if(i)return void i(e.success);var t=H("IdinTransaction",{transaction:e.success});J(t,window)}else{P("KYC could retrieve IDIN ISSUERS!","getIdinIssuers",e.error),i&&i(null)}}})},m=function(r){var e={url:T+"/api/v1/users/"+E.data.uuid+"/dossiers",callback:function(e){if(e.success){var t=f(),i=(e.success.filter(function(e){return!!E.data.clientId&&e.clientId==E.data.clientId}).shift()||{dossiers:[]}).dossiers;if(!r){var n=H("dossiers",{dossiers:i});return void J(n,window)}r.kyc.status.changed=new Date,r.kyc.dossiers=i.filter(function(e){return t&&t.dossierId?e.id==t.dossierId:e.templateId&&r.kyc.context.templateId?e.templateId==r.kyc.context.templateId:!e.id||!r.kyc.context.dossierId||e.id==r.kyc.context.dossierId});var a=b(r);switch(a.dossiers=i,J("dossiers",r,a),r.kyc.dossiers.length){case 0:I(r);break;case 1:v(r.kyc.dossiers[0].id,r);break;default:V(r)}}else P("KYC dossiers could not be fetched!","getDossiers",e.error,null,r)}};M(e)},v=function(a,r){var c=r?r.kyc.dossiers.filter(function(e){return e.id==a}).shift():null,e={url:T+"/api/v1/dossiers/"+a+"/tasks",callback:function(e){if(e.success){var t=e.success.filter(function(e){return e.visible});if(!r){var i=H("tasks",{tasks:t});return void J(i,window)}if(r.kyc.status.changed=new Date,c)switch(c.tasks=t,c.tasks.length){case 1:h(t[0].id,c.id,r);break;default:X(r,c)}var n=b(r);return n.tasks=t,void J("tasks",r,n)}P("KYC dossier tasks could not be fetched!","getTasks",e.error,{dossierId:a},r)}};if(r){if(c)return c.tasks?void X(r,c):void M(e);console.warn("KYC dossier could not be fetched!")}M(e)},h=function(a,r,c){var o,s=c?c.kyc.dossiers.filter(function(e){return e.id==r}).shift():null,e={url:T+"/api/v1/tasks/"+a,callback:function(e){if(e.success){var i=e.success;if(!c){var t=H("task",{task:i});return void J(t,window)}if(c.kyc.status.changed=new Date,s&&o){var n;if(window.kyc_config&&window.kyc_config.prefill&&"function"==typeof window.kyc_config.prefill)i.checks.map(function(e){e&&!e.value&&e.definition&&e.definition.metaDataKey&&(n||(n={}),n[e.definition.metaDataKey]="")}),n&&window.kyc_config.prefill(n,function(t){t&&(i.checks=i.checks.map(function(e){return e&&!e.value&&e.definition&&e.definition.metaDataKey&&t[e.definition.metaDataKey]&&(e.value=t[e.definition.metaDataKey]),e})),c.kyc.status.changed=new Date,Q(c,s,o=i),J("task",c)});c.kyc.status.changed=new Date,Q(c,s,o=i)}J("task",c)}else P("KYC dossier task could not be fetched!","getTask",e.error,{taskId:a,dossierId:r},c)}};if(c){if(s){if(s.tasks){if(o=s.tasks.filter(function(e){return e.id==a}).shift()){if(o.checks)return void Q(c,s,o);M(e)}return}return void P("KYC dossier could not be fetched!","getTask",{description:"invalid KYC dossier"},{taskId:a,dossierId:r},c)}M(e)}else;},R=function(i,n,a){M({url:T+"/api/v1/uploads/"+i,method:"GET",callback:function(e){if(e.success){if(q[i]=e.success,n)return void(a&&a({success:e.success}));var t=H("uploadId",{uploadId:i,content:e.success});J(t,window)}else P("No upload with the id "+i+" could be retrieved!","getUpload",e.error,{uploadId:i},n),a&&a({error:e.error})}})},B=function(i,n,a){M({url:T+"/api/v1/uploads/",params:i,method:"POST",callback:function(e){if(e.success&&e.success.uuid){if(q[e.success.uuid]=i,n)return void(a&&a({success:e.success}));var t=H("saveUpload",{uploadId:e.success.uuid,content:i});J(t,window)}else P("The upload could not be saved!","saveUpload",e.error||{description:"no uploadId returned"},{contant:i},n),a&&a({error:e.error||{description:"no uploadId returned"}})}})},Y=function(n,a,r){var e={url:T+"/api/v1/tasks/"+n.id,method:"POST",params:JSON.stringify(n),callback:function(e){if(e.success){if(!a){var t=H("saveTask",{task:n});return void J(t,window)}a.kyc.status.changed=new Date;var i=b(a);return i.task=n,J("savetask",a,i),void(r&&r({success:e.success}))}P("The task could not be saved!","saveTask",e.error,{task:n},a),r&&r({error:e.error})}};M(e)},g=function(e,t){if(!window.kyc_config)return l&&console.warn("No kyc_config object found on window!"),!1;var i=l;if(window.kyc_config&&(l=!0),!window.kyc_config.authorisationEndPoint)return l&&console.warn("No kyc authorisationEndPoint on the kyc_config object!"),!1;if(!window.kyc_config.kycApiEndPoint)return l&&console.warn("No kyc kycApiEndPoint on the kyc_config object!"),!1;if(a=window.kyc_config.authorisationEndPoint,T=window.kyc_config.kycApiEndPoint,!t){if(!window.kyc_config.context)return l&&console.warn("No context object found on the kyc_config object!"),!1;t=window.kyc_config.context}if(!e){if(!window.kyc_config.elementId)return i&&(console.warn("No elementId object found on the kyc_config object!"),console.warn("Assuming Direct SDK Access!")),{element:window,context:JSON.parse(JSON.stringify(t))};if(!(e=window.kyc_config.elementId))return l&&console.warn("No elementId is given!"),!1}return e?document.getElementById(e)?{element:document.getElementById(e),context:JSON.parse(JSON.stringify(t))}:(l&&console.warn("The HTML element with id '"+e+"'  is not present in the DOM tree!"),!1):void 0},H=function(e,t){var i;return"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event")).initEvent(e,!0,!0),t&&(i.detail=t),i},P=function(e,t,i,n,a){console.warn(e,t,i,n);var r={action:t,message:e,error:i};if(n)for(var c in n)r[c]||(r[c]=n[c]);if(a){for(var c in n=b(a))r[c]||(r[c]=n[c]);J("error",a,r)}else{console.info("throw",r);var o=H("error",r);J(o,window)}},F=function(e){return e=e||"",window.kyc_config&&window.kyc_config.translate&&"function"==typeof window.kyc_config.translate?window.kyc_config.translate(e):e},J=function(t,e,i){var n;t&&"string"==typeof t&&e&&e.kyc&&(t=H(t.trim(),i||b(e)));try{n=JSON.parse(JSON.stringify(t))}catch(e){return void console.warn(e,t,typeof t)}n.isTrusted=!0,n.type=t.type.toString(),e?function(e,t,i){if(e!=window&&(e.kyc.eventType=t),"createEvent"in document){var n=document.createEvent("HTMLEvents");return n.initEvent("load",!1,!0),n.kyctype=t,i&&(n.detail=i),e.dispatchEvent(n)}e.fireEvent("onload")}(n.target=e,n.type,n.detail):n.target="kyc_sdk",window.kyc_config&&window.kyc_config.onEvent&&"function"==typeof window.kyc_config.onEvent?window.kyc_config.onEvent(n):l&&console.warn("No onEvent function found on the kyc_config object!",{event:n})},j=function(e,t){var i=t||d,n=i.querySelector(e);return n?n.cloneNode(!0):(console.warn("A templating error has occured.!",{selector:e,template:i.innerHTML}),null)},N={IBAN:function(e){var t,i=String(e).toUpperCase().replace(/[^A-Z0-9]/g,""),n=i.match(/^([A-Z]{2})(\d{2})([A-Z\d]+)$/);return!(!n||i.length!=={AD:24,AE:23,AT:20,AZ:28,BA:20,BE:16,BG:22,BH:22,BR:29,CH:21,CR:21,CY:28,CZ:24,DE:22,DK:18,DO:28,EE:20,ES:24,FI:18,FO:18,FR:27,GB:22,GI:23,GL:18,GR:27,GT:28,HR:21,HU:28,IE:22,IL:23,IS:26,IT:27,JO:30,KW:30,KZ:20,LB:28,LI:21,LT:20,LU:20,LV:21,MC:27,MD:24,ME:22,MK:19,MR:27,MT:31,MU:30,NL:18,NO:15,PK:24,PL:28,PS:29,PT:25,QA:29,RO:24,RS:22,SA:24,SE:24,SI:19,SK:24,SM:27,TN:24,TR:26}[n[1]])&&(t=(n[3]+n[1]+n[2]).replace(/[A-Z]/g,function(e){return((e||"").toString().charCodeAt(0)-55).toString()}),N.mod97(t))},mod97:function(e){for(var t,i=e.slice(0,2),n=2;n<e.length;n+=7)t=String(i)+e.substring(n,n+7),i=parseInt(t,10)%97;return i}},G=function(e){var t=e.target.getAttribute("data-value-format");switch(e.type){case"prefill":switch(t){case"PHONE_NUMBER":e.target.value=(e.target.value||"").replace(/[^0-9\s\+]/g,"").trim().replace(/^00+/g,"+");break;case"IBAN":e.target.value=(e.target.value||"").toUpperCase().replace(/[^A-Z0-9\s]/g,"").trim()}return;case"tokyc":switch(t){case"PHONE_NUMBER":e.target.value=(e.target.value||"").replace(/[\+]/g,"00").replace(/[^0-9]/g,"").trim();break;default:e.target.value=(e.target.value||"").trim()}return e.target.value;case"change":switch(t){case"IBAN":e.target.setCustomValidity(N.IBAN(e.target.value||"")?"Invalid IBAN":"");break;case null:default:e.target.setCustomValidity(e.target.required&&""===(e.target.value||"").trim()?"No empty strings":"")}break;case"input":e.inputType&&"insertFromPaste"==e.inputType&&G({target:e.target,type:"prefill"});break;case"keypress":var i=e.keyCode||e.which,n=String.fromCharCode(i),a=void 0;switch(t){case"PHONE_NUMBER":if(a=["Backspace","ArrowLeft","ArrowRight",8,37,39],/[\s\+]|\./.test(n)&&e.target.value.trim()||!/[0-9\s\+]|\./.test(n)&&a.indexOf(i)<0)return void e.preventDefault();break;case"IBAN":if(a=["Backspace","ArrowLeft","ArrowRight",8,37,39],!/[A-Z0-9\-\s]|\./.test(n.toUpperCase())&&a.indexOf(i)<0)return void e.preventDefault()}}var r=(e.path||[]).filter(function(e){return!!e&&!!e.tagName&&"FORM"===e.tagName}).shift();r&&r.tagName&&L.slice.call(r.querySelectorAll("[data-kyc-task-next]")).map(function(e){e.disabled=!!r&&!r.checkValidity()})},Z=function(e){if(e&&e.appendChild){e.innerHTML="";var t=j("[data-kyc-loader]",e.kyc.template);t&&e.appendChild(t),e.setAttribute("kyc-sdk-status","loading")}},I=function(t){if(t)try{var e=j("[data-kyc-dossier-list]",t.kyc.template),i=e.querySelector("[data-kyc-dossier-item]"),n=e.querySelector("[data-kyc-dossier-none]"),a=n.querySelector("kyc-dossier-error");a?a.parentNode.replaceChild(document.createTextNode(F("No dossiers found")),a):n.appendChild(document.createTextNode(F("No dossiers found"))),i.parentNode.removeChild(i),t.innerHTML="",t.appendChild(e),t.setAttribute("kyc-sdk-status","dossiers"),J("dossierlist",t)}catch(e){return void P("A templating error has occured while building the dossier list!","dossierlist",e,{template:t.kyc.template},t)}},V=function(r){if(r&&r.appendChild)try{var e=j("[data-kyc-dossier-list]",r.kyc.template),c=e.querySelector("[data-kyc-dossier-item]"),t=e.querySelector("[data-kyc-dossier-none]"),o=(Array.prototype,c);t.parentNode.removeChild(t),r.kyc.dossiers.map(function(t){var e=c.cloneNode(!0),i=e.querySelector("kyc-dossier-name"),n=e.querySelector("kyc-dossier-status"),a=e.querySelector("kyc-dossier-created");e.setAttribute("data-kyc-status",t.status),i&&i.parentNode.replaceChild(document.createTextNode(t.customerName),i),n&&n.parentNode.replaceChild(document.createTextNode(F(t.status)),n),a&&a.parentNode.replaceChild(document.createTextNode(function(e){if(window.kyc_config&&window.kyc_config.formatDate&&"function"==typeof window.kyc_config.formatDate)return window.kyc_config.formatDate(e)}(new Date(t.createdAt))),a),o.parentNode.insertBefore(e,o.nextSibling),e.addEventListener("click",function(e){Z(r),r.kyc.history.back=[],r.kyc.history.next=[],v(t.id,r)}),o=e}),c.parentNode.removeChild(c),r.innerHTML="",r.appendChild(e),r.setAttribute("kyc-sdk-status","dossiers"),J("dossierlist",r)}catch(e){return void P("A templating error has occured while building the dossier list!","dossierlist",e,{template:r.kyc.template},r)}},X=function(a,r){if(a&&a.appendChild)try{var e=j("[data-kyc-task-list]",a.kyc.template),t=e.querySelector("[data-kyc-dossier-title] kyc-text"),c=e.querySelector("[data-kyc-task-item]"),i=e.querySelectorAll("[data-kyc-to-dossiers]"),o=-1<["ACCEPTED","SUBMITTED"].indexOf(r.status)?r.status:null,s=c;t&&t.parentNode.replaceChild(document.createTextNode(r.customerName),t),L.slice.call(i).map(function(e){1<a.kyc.dossiers.length?(L.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(F("Back")),e)}),e.addEventListener("click",function(){V(a)})):e.parentNode.removeChild(e)}),r.tasks.map(function(t){var e=c.cloneNode(!0),i=e.querySelector("kyc-task-name"),n=e.querySelector("kyc-task-status");e.setAttribute("data-kyc-status",o||t.status),i&&i.parentNode.replaceChild(document.createTextNode(t.name),i),n&&n.parentNode.replaceChild(document.createTextNode(F(o||t.status)),n),s.parentNode.insertBefore(e,s.nextSibling),e.addEventListener("click",function(e){Z(a),a.kyc.history.back=[],a.kyc.history.next=[],h(t.id,r.id,a)}),s=e}),c.parentNode.removeChild(c),a.innerHTML="",a.appendChild(e),a.setAttribute("kyc-sdk-status","tasks"),J("tasklist",a)}catch(e){return void P("A templating error has occured while building the dossier task list!","tasklist",e,{template:a.kyc.template},a)}},Q=function(r,c,o,s){if(r&&r.appendChild)if(-1<["ACCEPTED","SUBMITTED"].indexOf(c.status)?c.status:-1<["ACCEPTED","SUBMITTED"].indexOf(o.status)?o.status:null)!function(t,i,n){if(t&&t.appendChild)try{var e=j("[data-kyc-dossier]",t.kyc.template);L.slice.call(e.querySelectorAll("[name]")).map(function(e){e.removeAttribute("name")});var a,r=e.querySelector("[data-kyc-dossier-title] kyc-text"),c=(e.querySelector(" [data-kyc-dossier-tasks-navigation]"),e.querySelector("[data-kyc-task]")),o=c.querySelector("[data-kyc-task-title] kyc-text"),s=c.querySelector("[data-kyc-check]"),d=c.querySelector("[data-kyc-check-status]").querySelector("kyc-task-status"),l=c.querySelector("[data-kyc-task-overview]"),u=l.querySelector("[data-kyc-task-overview-check]"),k=(c.querySelector("[data-kyc-task-navigation]"),document.createElement("input")),f=(s.querySelector("[data-kyc-input]").cloneNode(!0),-1<["ACCEPTED","SUBMITTED"].indexOf(i.status)?i.status:-1<["ACCEPTED","SUBMITTED"].indexOf(n.status)?n.status:null),p=u;r&&r.parentNode.replaceChild(document.createTextNode(i.customerName),r),o&&o.parentNode.replaceChild(document.createTextNode(n.name),o),d&&d.parentNode.replaceChild(document.createTextNode(F(f||n.status)),d),l&&l.setAttribute("data-kyc-status",f||n.status),c&&c.setAttribute("data-kyc-status",f||n.status),n.checks.map(function(t){if((t.value||"").trim()){var e=u.cloneNode(!0),i=e.querySelector(" data-kyc-check-value");switch(L.slice.call(e.querySelectorAll("kyc-check-description")).map(function(e){t.definition.description?e.parentNode.replaceChild(document.createTextNode(F(t.definition.description)),e):e.parentNode.removeChild(e)}),e.setAttribute("data-kyc-check-value",t.value),t.definition.method&&e.setAttribute("data-kyc-method",t.definition.method||null),t.definition.valueFormat&&e.setAttribute("data-kyc-valueformat",t.definition.valueFormat||null),t.definition.method){case"RAW_DOCUMENT_SCAN":case"DOCUMENT_FILE_UPLOAD":case"SELFIE_CHECK":if(a=document.createTextNode(""),t.value)if(a=document.createElement("img"),q[t.value])a.setAttribute("src",q[t.value]);else{var n={url:T+"/api/v1/uploads/"+t.value,method:"GET",callback:function(e){e.success?a.setAttribute("src",q[t.value]):console.warn("No upload with the id "+t.value+" could be retrieved!",e.error)}};M(n)}break;default:switch(k.value=t.value||null,t.definition.valueFormat){case"NATURAL_NUMBER":case"REAL_NUMBER":k.setAttribute("type","number"),"NATURAL_NUMBER"==t.definition.valueFormat&&(k.setAttribute("step","1"),k.setAttribute("min","0"));break;case"EMAIL":k.setAttribute("type","email");break;case"URL":k.setAttribute("type","url");break;case"PHONE_NUMBER":case"IBAN":k.setAttribute("type","tel");break;default:k.setAttribute("type","text")}G({type:"prefill",target:k}),a=document.createTextNode(k.value)}i.parentNode.replaceChild(a,i),p.parentNode.insertBefore(e,p.nextSibling),p=e}}),s.parentNode.removeChild(s),u.parentNode.removeChild(u),L.slice.call(e.querySelectorAll("[data-kyc-to-dossiers]")).map(function(e){1<t.kyc.dossiers.length?(L.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(F("Back")),e)}),e.addEventListener("click",function(){V(t)})):e.parentNode.removeChild(e)}),L.slice.call(e.querySelectorAll("[data-kyc-to-tasks]")).map(function(e){1<n.checks.length?(L.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(F("Back")),e)}),e.addEventListener("click",function(){X(t,i)})):e.parentNode.removeChild(e)}),L.slice.call(e.querySelectorAll("[data-kyc-task-previous]")).map(function(e){L.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(F("Back")),e)}),e.addEventListener("click",function(){X(t,i)})}),L.slice.call(e.querySelectorAll("[data-kyc-task-next]")).map(function(e){e.parentNode.removeChild(e)}),t.innerHTML="",t.appendChild(e),t.setAttribute("kyc-sdk-status","task"),J("taskoverview",t)}catch(e){return P("A templating error has occured while building the dossier task check overview!","taskoverview",e,{template:t.kyc.template},t)}}(r,c,o);else{s=s||o.sequence.initialCheckId;var d=o.checks.filter(function(e){return e.id==s}).shift();if(d&&d.id){var t=o.sequence.transitions.filter(function(e){return e.from==s}).map(function(e){return e}).shift(),i=function(e){if(e){var t=e.defaultGoTo;if(e.conditionalBranches){var i=!1;e.conditionalBranches.map(function(e){if(!i)switch(e.relation){case"EQUAL":if(d.value.trim()===e.value.trim())return i=!0,void(t=e.goTo||null);break;case"NOT_EQUAL":if(d.value.trim()!=e.value.trim())return i=!0,void(t=e.goTo||null);break;case"GREATER_THAN":if(parseFloat(d.value.trim())>parseFloat(e.value.trim()))return i=!0,void(t=e.goTo||null);break;case"LESS_THAN":if(parseFloat(d.value.trim())<parseFloat(e.value.trim()))return i=!0,void(t=e.goTo||null);break;case"INCLUDES":if(d.value instanceof Array&&d.value.indexOf(e.value.trim()))return i=!0,void(t=e.goTo||null);break;case"EXCLUDES":if(d.value instanceof Array&&!d.value.indexOf(e.value.trim()))return i=!0,void(t=e.goTo||null)}})}if(t)return Z(r),r.kyc.history.back.push(function(){Z(r),Q(r,c,o,d.id)}),void Q(r,c,o,t)}Z(r),Y(o,r,function(e){e.success&&X(r,c)})};try{var e=j("[data-kyc-dossier]",r.kyc.template);L.slice.call(e.querySelectorAll("[name]")).map(function(e){e.removeAttribute("name")});var n,a=e.querySelector("[data-kyc-dossier-title] kyc-text"),l=(e.querySelector(" [data-kyc-dossier-tasks-navigation]"),e.querySelector("[data-kyc-task]")),u=l.querySelector("[data-kyc-task-overview]"),k=l.querySelector("[data-kyc-task-title] kyc-text"),f=l.querySelector("[data-kyc-check]"),p=l.querySelector("[data-kyc-check-status]"),y=(l.querySelector("[data-kyc-task-navigation]"),d.id.trim());a&&a.parentNode.replaceChild(document.createTextNode(c.customerName),a),k&&k.parentNode.replaceChild(document.createTextNode(o.name),k),p&&p.parentNode.removeChild(p),u&&u.parentNode.removeChild(u);var m,v=f.cloneNode(!0),h=v.querySelector("kyc-input");switch(L.slice.call(v.querySelectorAll("kyc-check-description")).map(function(e){d.definition.description?e.parentNode.replaceChild(document.createTextNode(F(d.definition.description)),e):e.parentNode.removeChild(e)}),L.slice.call(v.querySelectorAll("kyc-check-longdescription")).map(function(e){d.definition.longDescription?e.parentNode.replaceChild(document.createTextNode(F(d.definition.longDescription)),e):e.parentNode.removeChild(e)}),d.definition.method&&v.setAttribute("data-kyc-method",d.definition.method||null),d.definition.valueFormat&&v.setAttribute("data-kyc-valueformat",d.definition.valueFormat||null),d.definition.method){case"MANUAL_SINGLE_CHOICE_ENUM":case"MANUAL_MULTIPLE_CHOICE_ENUM":switch(n=h.querySelector("[data-kyc-options]").cloneNode(!1),d.definition.method){case"MANUAL_SINGLE_CHOICE_ENUM":if(d.definition.enumSpecification.length<4)(d.definition.enumSpecification||[]).map(function(t){var e=h.querySelector("[data-kyc-radiobutton]").cloneNode(!0),i=e.querySelector("[data-kyc-radio-input]");i.setAttribute("type","radio"),i.setAttribute("name",y),i.setAttribute("value",t.name),i.value=t.name,i.checked=!!d.value&&t.name.trim()===d.value.trim(),L.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(F(t.explanation?t.explanation:t.name)),e)}),m||(m=e),n.appendChild(e)});else{n=h.querySelector("[data-kyc-select-input]").cloneNode(!1);var g=(h.querySelector("[data-kyc-select-input]").querySelector("option")||document.createElement("option")).cloneNode(!1);n.setAttribute("name",y),d.value||(g.value="",g.innerHTML=F("select an option"),n.appendChild(g)),(d.definition.enumSpecification||[]).map(function(e){(g=g.cloneNode(!0)).value=e.name,g.selected=!!d.value&&e.name.trim()===d.value.trim(),g.innerHTML=F(e.explanation?e.explanation:e.name),n.appendChild(g)}),m||(m=n)}break;case"MANUAL_MULTIPLE_CHOICE_ENUM":y=d.id.trim()+"[]",(d.definition.enumSpecification||[]).map(function(t){var e=h.querySelector("[data-kyc-checkbox]").cloneNode(!0),i=e.querySelector("[data-kyc-checkbox-input]");i.setAttribute("type","checkbox"),i.setAttribute("name",y),i.setAttribute("value",t.name),i.checked=!!d.value&&0<JSON.parse(d.value||"[]").filter(function(e){return e.trim()==t.name.trim()}).length,L.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(F(t.explanation?t.explanation:t.name)),e)}),n.appendChild(e),m||(m=e)})}break;default:switch(d.definition.method){case"MANUAL_TEXT_INPUT":case"MANUAL_DATE_INPUT":switch(d.definition.valueFormat){case"LONG_TEXT":(n=h.querySelector("[data-kyc-textarea]").cloneNode(!0)).setAttribute("placeholder",F(d.definition.description)),n.value=d.value||null,n.setAttribute("name",y),n.required=!d.definition.optional,m||(m=n);break;default:switch(n=h.querySelector("[data-kyc-input]").cloneNode(!0),d.definition.valueFormat){case"NATURAL_NUMBER":case"REAL_NUMBER":n.setAttribute("type","number"),"NATURAL_NUMBER"==d.definition.valueFormat&&(n.setAttribute("step",1),n.setAttribute("min",0));break;case"EMAIL":n.setAttribute("type","email");break;case"URL":n.setAttribute("type","url");break;case"IBAN":n.setAttribute("type","text");break;case"PHONE_NUMBER":n.setAttribute("type","tel");break;default:switch(d.definition.method){case"MANUAL_DATE_INPUT":n.setAttribute("type","date");break;default:n.setAttribute("type","text")}}n.setAttribute("placeholder",F(d.definition.description)),n.setAttribute("name",d.id),d.definition.method&&n.setAttribute("data-method",d.definition.method),d.definition.valueFormat&&n.setAttribute("data-value-format",d.definition.valueFormat),n.required=!d.definition.optional,n.value=d.value||null,m||(m=n),G({type:"prefill",target:n})}["keypress","paste","change","input"].map(function(e){n.addEventListener(e,function(e){return G(e)})});break;case"IDIN":if(d.value)(n=document.createElement("div")).setAttribute("class",h.querySelector("[data-kyc-input]").getAttribute("class")),n.innerHTML="The IDIN check is Completed";else{if(D&&D.IDIN){var N=function(e){if(e&&e.status&&e.transactionId)switch(e.status){case"open":setTimeout(function(){K(e.transactionId,N)},1e3);break;case"success":delete D.IDIN,r.kyc.context.checkId=null,r.kyc.context.taskId=null,r.kyc.context.dossierId=null,d.value=e.transactionId,i(t);break;case"expired":case"cancelled":case"failure":default:return delete D.IDIN,void Q(r,c,o,s)}else delete D.IDIN,Q(r,c,o,s)};return void N(D)}if(!_.IDIN)return void function(i){if(_.IDIN){if(i)return i(_.IDIN);var e=H("IDIN",{issuers:_.IDIN});J(e,window)}else M({url:T+"/api/v1/identityservices/idin/issuers",callback:function(e){if(e.success){if(_.IDIN=e.success,i)return void i(_.IDIN);var t=H("IdinIssuers",{issuers:_.IDIN});J(t,window)}else P("KYC could retrieve IDIN ISSUERS!","getIdinIssuers",e.error),i&&i(null)}})}(function(e){e?Q(r,c,o,s):P("A templating error has occured while building the dossier task check form! No IDIN Issuers could be fetched","taskform",{description:"No IDIN Issuers"},{template:r.kyc.template,dossier:c,task:o,checkid:s},r)});if(n=document.createElement("div"),_.IDIN&&0<(_.IDIN||[]).length)if(_.IDIN&&1<(_.IDIN||[]).length){var I=h.querySelector("[data-kyc-select-input]").cloneNode(!1),b=(h.querySelector("[data-kyc-select-input]").querySelector("option")||document.createElement("option")).cloneNode(!1);b.value="",b.innerHTML=F("select a country"),I.appendChild(b),(_.IDIN||[]).map(function(e){e.country&&((b=(h.querySelector("[data-kyc-select-input]").querySelector("option")||document.createElement("option")).cloneNode(!1)).value=e.country||"",b.innerHTML=F(e.country||""),I.appendChild(b))}),m||(m=I),n.appendChild(I),I.addEventListener("change",function(e){if(e.target.value){var t=h.querySelector("[data-kyc-select-input]").cloneNode(!1),i=(h.querySelector("[data-kyc-select-input]").querySelector("option")||document.createElement("option")).cloneNode(!1);i.value="",i.innerHTML=F("select a issuer"),t.appendChild(i),(_.IDIN||[]).slice(0,1).map(function(e){e.issuers&&(e.issuers||[]).map(function(e){(i=(h.querySelector("[data-kyc-select-input]").querySelector("option")||document.createElement("option")).cloneNode(!1)).value=e.id||"",i.innerHTML=F(e.name||""),t.appendChild(i)})}),e.target.parentNode.appendChild(t),e.target.parentNode.removeChild(e.target),t.focus(),t.addEventListener("change",function(e){if(e.target.value){var t=e.target.value.trim(),i=d.definition.requestedIdinKeys,n=U(32),a={KYCToken:E,context:JSON.parse(JSON.stringify(r.kyc.context))};Z(r),a.context.taskId=o.id,a.context.dossierId=c.id,a.context.checkId=s,O(t,i,{KYCSECRET:n,KYCStorage:a})}})}})}else{var S=h.querySelector("[data-kyc-select-input]").cloneNode(!1),A=(h.querySelector("[data-kyc-select-input]").querySelector("option")||document.createElement("option")).cloneNode(!1);A.value="",A.innerHTML=F("select a issuer"),S.appendChild(A),(_.IDIN||[]).slice(0,1).map(function(e){e.issuers&&(e.issuers||[]).map(function(e){(A=(h.querySelector("[data-kyc-select-input]").querySelector("option")||document.createElement("option")).cloneNode(!1)).value=e.id||"",A.innerHTML=F(e.name||""),S.appendChild(A)})}),m||(m=S),n.appendChild(S),S.addEventListener("change",function(e){if(e.target.value){var t=e.target.value.trim(),i=d.definition.requestedIdinKeys,n=U(32),a={KYCToken:E,context:JSON.parse(JSON.stringify(r.kyc.context))};Z(r),a.context.taskId=o.id,a.context.dossierId=c.id,a.context.checkId=s,O(t,i,{KYCSECRET:n,KYCStorage:a})}})}else n.innerHTML=F("No IDIN issuers")}break;case"RAW_DOCUMENT_SCAN":case"DOCUMENT_FILE_UPLOAD":case"SELFIE_CHECK":var C=(n=h.querySelector("[data-kyc-file]").cloneNode(!0)).querySelector("[data-kyc-file-input]"),w=(h.querySelector("kyc-placeholder"),n.querySelector("[data-kyc-file-preview]")),x=document.createElement("input");x.setAttribute("type","hidden"),x.required=!d.definition.optional,x.value=d.value||null,x.setAttribute("name",y),n.appendChild(x),d.definition.method&&x.setAttribute("data-method",d.definition.method),d.definition.valueFormat&&x.setAttribute("data-value-format",d.definition.valueFormat),C.setAttribute("type","file"),C.setAttribute("placeholder",F(d.definition.description)),m||(m=C),w.innerHTML=F(d.definition.description),C.addEventListener("change",function(e){if(e.target.files&&e.target.files[0]){var t=new FileReader;t.onload=function(t){t&&t.target&&t.target.result&&B(t.target.result,r,function(e){e.success&&e.success.uuid&&(q[e.success.uuid]=t&&t.target&&t.target.result?t.target.result:"",w.setAttribute("style",'background-image:url("'+q[e.success.uuid]+'")'),x.value=e.success.uuid,x.setAttribute("value",e.success.uuid),G({target:x,type:"change"}))})},w.innerHTML=e.target.files[0].name,t.readAsDataURL(e.target.files[0])}}),d.value&&(q[d.value]?w.setAttribute("style",'background-image:url("'+q[d.value]+'")'):R(d.value,r,function(e){e.success&&w.setAttribute("style",'background-image:url("'+q[d.value]+'")')}))}}h.parentNode.replaceChild(n,h),f.parentNode.replaceChild(v,f),L.slice.call(e.querySelectorAll("[data-kyc-to-dossiers]")).map(function(e){1<r.kyc.dossiers.length?(L.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(F("Back")),e)}),e.addEventListener("click",function(){V(r)})):e.parentNode.removeChild(e)}),L.slice.call(e.querySelectorAll("[data-kyc-to-tasks]")).map(function(e){1<o.checks.length?(L.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(F("Back")),e)}),e.addEventListener("click",function(){X(r,c)})):e.parentNode.removeChild(e)}),0<r.kyc.history.back.length?L.slice.call(e.querySelectorAll("[data-kyc-task-previous]")).map(function(e){L.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(F("Back")),e)}),e.addEventListener("click",function(){var e,t;(t=(e=r).kyc.history.back.pop())&&(e.kyc.history.next.push(t),"function"==typeof t&&t())})}):L.slice.call(e.querySelectorAll("[data-kyc-task-navigation] [data-kyc-task-previous]")).map(function(e){e.parentNode.removeChild(e)}),L.slice.call(e.querySelectorAll("[data-kyc-task-next]")).map(function(e){e.disabled=!!l&&!l.checkValidity(),L.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(F("Next")),e)}),e.addEventListener("click",function(){if(l&&l.checkValidity())return d.value=y==d.id?G({type:"tokyc",target:l.querySelector('[name="'+y+'"]')}):JSON.stringify(L.slice.call(l.querySelectorAll('[name="'+y+'"]')).map(function(e){return G({type:"tokyc",target:e})})),void i(t)})}),r.innerHTML="",r.appendChild(e),r.setAttribute("kyc-sdk-status","task"),m&&m.focus(),J("taskform",r)}catch(e){P("A templating error has occured while building the dossier task check form!","taskform",e,{template:r.kyc.template,dossier:c,task:o,checkid:s},r)}}else P("The check could not be determined!","taskform",{description:"check is undefined"},{dossier:c,task:o,checkid:s},r)}},b=function(e){return{context:e.kyc.context,status:e.kyc.status}},S=function(e,t){var i=f();i&&i.context&&(t=i.context);var n,a,r,c,o=document.createElement("kyc-view"),s=g(e,t);return!!s&&(e&&(l=!0),a=s.element,r=s.context,a&&(a.kyc?(a.setAttribute&&a.setAttribute("kyc-sdk-status","ready"),a.kyc.status.reset=new Date,a.kyc.context=r,c=H("reset",b(a))):(n={initialised:new Date,version:u},c=H("initialised",{status:n,context:r}),a.kyc={context:s.context,status:n,template:function(e){d=document.createElement("kyc-template");var t=document.createElement("kyc-custom-template"),i=document.createElement("kyc-default-template");return i.innerHTML='/*\x3c!-- Define the template for the dossier-list --\x3e<ul data-kyc-dossier-list><li data-kyc-dossier-none><span><kyc-dossier-error></kyc-dossier-error></span></li><li data-kyc-dossier-item><span><kyc-dossier-name></kyc-dossier-name></span><span><kyc-dossier-status></kyc-dossier-status></span><span><kyc-dossier-created></kyc-dossier-created></span></li></ul>\x3c!-- Define the template for the task-list in a dossier--\x3e<div data-kyc-task-list><h1 data-kyc-dossier-title><button data-kyc-to-dossiers></button><kyc-text></kyc-text></h1><ul><li data-kyc-task-item><span><kyc-task-name></kyc-task-name></span><span><kyc-task-status></kyc-task-status></span></li></ul></div>\x3c!-- Define the template for a single dossier --\x3e<div data-kyc-dossier><h1 data-kyc-dossier-title><button data-kyc-to-dossiers></button><kyc-text></kyc-text></h1>\x3c!-- Define the template for a single task in a dossier --\x3e<form data-kyc-task><h2 data-kyc-task-title><button data-kyc-to-tasks></button><kyc-text></kyc-text></h2>\x3c!-- Define the template for a single check in a task in a dossier --\x3e<div data-kyc-check><label><kyc-check-description></kyc-check-description></label><kyc-input><input data-kyc-input> <textarea data-kyc-textarea></textarea> <select data-kyc-select-input></select><div data-kyc-options><div data-kyc-checkbox><label><input type="checkbox" data-kyc-checkbox-input><kyc-text></kyc-text></label></div><div data-kyc-radiobutton><label><input type="radio" data-kyc-radio-input><kyc-text></kyc-text></label></div></div><div data-kyc-file><input type="file" class="form-control" data-kyc-file-input><div class="filepreview" data-kyc-file-preview></div></div></kyc-input><small><kyc-check-longdescription></kyc-check-longdescription></small></div>\x3c!-- Define the template for the check overview in a task in a dossier --\x3e<div data-kyc-check-overview><label><kyc-check-description></kyc-check-description></label><p><data-kyc-check-value></data-kyc-check-value></p></div>\x3c!-- Define the template the navigation between tasks in a dossier --\x3e<div data-kyc-task-navigation><button data-kyc-task-previous><kyc-text></kyc-text></button> <button data-kyc-task-next><kyc-text></kyc-text></button></div></form></div>\x3c!-- Define the template the loader --\x3e<div data-kyc-loader></div>*/',t.innerHTML=e,d.appendChild(t),d.appendChild(i),d.cloneNode(!0)}(a.innerHTML.trim()),history:{back:[],next:[]}},a.setAttribute&&(a.setAttribute("kyc-sdk-status","ready"),Z(a),a.appendChild(o)))),J(c,a),p(a),a)};if(!window[t]){window[t]={get initialised(){return n},get version(){return u},init:S,getOrigLocation:function(){return i},getToken:function(){return p()},getMe:function(){if(E)return y();P("no valid Identification","getDossiers",{description:"missing KYCToken"})},getDossiers:function(){if(E)return m();P("no valid Identification","getDossiers",{description:"missing KYCToken"})},getTasks:function(e){if(E)return v(e);P("no valid Identification","getTasks",{description:"missing KYCToken"})},getTask:function(e){if(E)return h(e);P("no valid Identification"," getTask",{description:"missing KYCToken"})},getUpload:function(e){if(E)return R(e);P("no valid Identification"," getTask",{description:"missing KYCToken"})},saveUpload:function(e){if(E)return B(e);P("no valid Identification"," getTask",{description:"missing KYCToken"})},saveTask:function(e){if(E)return Y(e);P("no valid Identification","saveTask",{description:"missing KYCToken"})}};var A=H("ready",{status:{initialised:n,version:u}});J(A,window),e=function(){f(),g()&&S()},"complete"===document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&e()})}}();