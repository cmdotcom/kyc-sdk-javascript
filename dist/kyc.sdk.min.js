"use strict";!function(){window.console&&"undefined"!=typeof console||(console=console||{},["assert","clear","count","error","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","trace","warn"].map(function(e){console[e]=function(){}}));var s,n,w,c,e,d=!1,t="kyc_sdk",l="0.0.1",A={},i=new Date,x=Array.prototype,r=function(t){t&&"string"==typeof t&&(t={url:t.trim()}),t.method=t.method||"GET";var i,a=function(e){t.callback&&"function"==typeof t.callback&&t.callback(e)},n=new XMLHttpRequest,e=t.params;try{n.open(t.method,t.url)}catch(e){return void a({error:e,xhr:n})}if(n.withCredentials=t.withCredentials||!1,n.addEventListener("load",function(){if(4==n.readyState)if(200<=n.status&&n.status<300){try{i=JSON.parse(n.response||n.responseText)}catch(e){i=n.response||n.responseText}a({success:i||"OK",xhr:n})}else{try{i=JSON.parse(n.response||n.responseText)}catch(e){i="invalid http status"}a({error:i||"ERROR",xhr:n})}}),n.addEventListener("error",function(){a({error:"invalid http status",xhr:n})}),t.headers)for(var c in t.headers)n.setRequestHeader(c,t.headers[c]);if("GET"==t.method&&t.params&&"object"==typeof t.params){for(var c in e=[],t.params)e.push(encodeURIComponent(c)+"="+encodeURIComponent(e[c]));e=e.join("&")}try{n.send(e)}catch(e){a({error:e,xhr:n})}},T=function(e){e.headers={Authorization:"Bearer "+c.userToken},r(e)},u=function(i){if(c&&c.userToken){if(!i){var e=m("getToken",{KYCToken:c});return void q(e,window)}o(i)}else{var t=i||window;if(!(t&&(t.kyc&&t.kyc.context||t.kyc_config&&t.kyc_config.context)))return void I("No kyc config found","getToken",{description:"invalid KYC configuration"},{config:t?t.kyc_config||t.kyc:null},i);var a={url:n,method:"POST",withCredentials:!0,headers:{"Content-Type":"application/json;charset=UTF-8"},params:JSON.stringify({clientId:(t.kyc_config||t.kyc).context.clientId,templateId:(t.kyc_config||t.kyc).context.templateId,customerName:(t.kyc_config||t.kyc).context.customerName,externalReference:(t.kyc_config||t.kyc).context.externalReference,firstName:(t.kyc_config||t.kyc).context.firstName,lastName:(t.kyc_config||t.kyc).context.lastName,msisdn:(t.kyc_config||t.kyc).context.msisdn,userIdentifier:(t.kyc_config||t.kyc).context.userIdentifier}),callback:function(e){if(e.success){if((c=e.success).data=function(e){try{var t=e.split(".")[0].replace("-","+").replace("_","/"),i=JSON.parse(window.atob(t)),a=e.split(".")[1].replace("-","+").replace("_","/"),n=JSON.parse(window.atob(a));return n.header=i,n}catch(e){return!1}}(c.userToken),!i){var t=m("getToken",{KYCToken:c});return void q(t,window)}q("login",i),o(i)}else I("No kyc Token could be retrieved from "+n+"!","getToken",e,{authorisationEndPoint:n},i)}};r(a)}},o=function(c){T({url:w+"/api/v1/users/me",callback:function(e){if(e.success){if(c)return c.kyc.status.changed=new Date,c.kyc.context.firstName=e.success.firstName,c.kyc.context.lastName=e.success.lastName,c.kyc.context.msisdn=e.success.msisdn,c.kyc.context.userIdentifier=e.success.id,q("identification",c),void k(c);var t=m("me",{me:e.success});q(t,window)}else{var i="KYC identity could not be verified!";if(console.warn(i,e.error),c){var a=g(c);a.action="getMe",a.message=i,a.error=e.error,q("error",c,a)}else{var n=m("error",{action:"getMe",message:i,error:e.error});q(n,window)}}}})},k=function(n){var e={url:w+"/api/v1/users/"+c.data.uuid+"/dossiers",callback:function(e){if(e.success){var t=(e.success.filter(function(e){return!!c.data.clientId&&e.clientId==c.data.clientId}).shift()||{dossiers:[]}).dossiers;if(!n){var i=m("dossiers",{dossiers:t});return void q(i,window)}n.kyc.status.changed=new Date,n.kyc.dossiers=t.filter(function(e){return e.templateId&&n.kyc.context.templateId?e.templateId==n.kyc.context.templateId:!e.id||!n.kyc.context.dossierId||e.id==n.kyc.context.dossierId});var a=g(n);switch(a.dossiers=t,q("dossiers",n,a),n.kyc.dossiers.length){case 0:h(n);break;case 1:y(n.kyc.dossiers[0].id,n);break;default:U(n)}}else I("KYC dossiers could not be fetched!","getDossiers",e.error,null,n)}};T(e)},y=function(n,c){var r=c?c.kyc.dossiers.filter(function(e){return e.id==n}).shift():null,e={url:w+"/api/v1/dossiers/"+n+"/tasks",callback:function(e){if(e.success){var t=e.success.filter(function(e){return e.visible});if(!c){var i=m("tasks",{tasks:t});return void q(i,window)}c.kyc.status.changed=new Date,r&&(r.tasks=t,O(c,r));var a=g(c);return a.tasks=t,void q("tasks",c,a)}I("KYC dossier tasks could not be fetched!","getTasks",e.error,{dossierId:n},c)}};if(c){if(r)return r.tasks?void O(c,r):void T(e);console.warn("KYC dossier could not be fetched!")}T(e)},f=function(n,c,r){var o,s=r?r.kyc.dossiers.filter(function(e){return e.id==c}).shift():null,e={url:w+"/api/v1/tasks/"+n,callback:function(e){if(e.success){var i=e.success;if(!r){var t=m("task",{task:i});return void q(t,window)}if(r.kyc.status.changed=new Date,s&&o){var a;if(window.kyc_config&&window.kyc_config.prefill&&"function"==typeof window.kyc_config.prefill)i.checks.map(function(e){e&&!e.value&&e.definition&&e.definition.metaDataKey&&(a||(a={}),a[e.definition.metaDataKey]="")}),a&&window.kyc_config.prefill(a,function(t){t&&(i.checks=i.checks.map(function(e){return e&&!e.value&&e.definition&&e.definition.metaDataKey&&t[e.definition.metaDataKey]&&(e.value=t[e.definition.metaDataKey]),e})),r.kyc.status.changed=new Date,B(r,s,o=i),q("task",r)});r.kyc.status.changed=new Date,B(r,s,o=i)}q("task",r)}else I("KYC dossier task could not be fetched!","getTask",e.error,{taskId:n,dossierId:c},r)}};if(r){if(s){if(s.tasks){if(o=s.tasks.filter(function(e){return e.id==n}).shift()){if(o.checks)return void B(r,s,o);T(e)}return}return void I("KYC dossier could not be fetched!","getTask",{description:"invalid KYC dossier"},{taskId:n,dossierId:c},r)}T(e)}else;},C=function(i,a,n){T({url:w+"/api/v1/uploads/"+i,method:"GET",callback:function(e){if(e.success){if(a)return void(n&&n({success:e.success}));var t=m("uploadId",{uploadId:i,content:e.success});q(t,window)}else I("No upload with the id "+i+" could be retrieved!","getUpload",e.error,{uploadId:i},a),n&&n({error:e.error})}})},S=function(i,a,n){T({url:w+"/api/v1/uploads/",params:i,method:"POST",callback:function(e){if(e.success&&e.success.uuid){if(a)return void(n&&n({success:e.success}));var t=m("saveUpload",{uploadId:e.success.uuid,content:i});q(t,window)}else I("The upload could not be saved!","saveUpload",e.error||{description:"no uploadId returned"},{contant:i},a),n&&n({error:e.error||{description:"no uploadId returned"}})}})},E=function(a,n,c){var e={url:w+"/api/v1/tasks/"+a.id,method:"POST",params:JSON.stringify(a),callback:function(e){if(e.success){if(!n){var t=m("saveTask",{task:a});return void q(t,window)}n.kyc.status.changed=new Date;var i=g(n);return i.task=a,q("savetask",n,i),void(c&&c({success:e.success}))}I("The task could not be saved!","saveTask",e.error,{task:a},n),c&&c({error:e.error})}};T(e)},p=function(e,t){if(!window.kyc_config)return d&&console.warn("No kyc_config object found on window!"),!1;var i=d;if(window.kyc_config&&(d=!0),!window.kyc_config.authorisationEndPoint)return d&&console.warn("No kyc authorisationEndPoint on the kyc_config object!"),!1;if(!window.kyc_config.kycApiEndPoint)return d&&console.warn("No kyc kycApiEndPoint on the kyc_config object!"),!1;if(n=window.kyc_config.authorisationEndPoint,w=window.kyc_config.kycApiEndPoint,!t){if(!window.kyc_config.context)return d&&console.warn("No context object found on the kyc_config object!"),!1;t=window.kyc_config.context}if(!e){if(!window.kyc_config.elementId)return i&&(console.warn("No elementId object found on the kyc_config object!"),console.warn("Assuming Direct SDK Access!")),{element:window,context:JSON.parse(JSON.stringify(t))};if(!(e=window.kyc_config.elementId))return d&&console.warn("No elementId is given!"),!1}return e?document.getElementById(e)?{element:document.getElementById(e),context:JSON.parse(JSON.stringify(t))}:(d&&console.warn("The HTML element with id '"+e+"'  is not present in the DOM tree!"),!1):void 0},m=function(e,t){var i;return"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event")).initEvent(e,!0,!0),t&&(i.detail=t),i},I=function(e,t,i,a,n){console.warn(e,t,i,a);var c={action:t,message:e,error:i};if(a)for(var r in a)c[r]||(c[r]=a[r]);if(n){for(var r in a=g(n))c[r]||(c[r]=a[r]);q("error",n,c)}else{console.info("throw",c);var o=m("error",c);q(o,window)}},_=function(e){return e=e||"",window.kyc_config&&window.kyc_config.translate&&"function"==typeof window.kyc_config.translate?window.kyc_config.translate(e):e},q=function(t,e,i){var a;t&&"string"==typeof t&&e&&e.kyc&&(t=m(t.trim(),i||g(e)));try{a=JSON.parse(JSON.stringify(t))}catch(e){return void console.warn(e,t,typeof t)}a.isTrusted=!0,a.type=t.type.toString(),e?function(e,t,i){if(e!=window&&(e.kyc.eventType=t),"createEvent"in document){var a=document.createEvent("HTMLEvents");return a.initEvent("load",!1,!0),a.kyctype=t,i&&(a.detail=i),e.dispatchEvent(a)}e.fireEvent("onload")}(a.target=e,a.type,a.detail):a.target="kyc_sdk",window.kyc_config&&window.kyc_config.onEvent&&"function"==typeof window.kyc_config.onEvent?window.kyc_config.onEvent(a):d&&console.warn("No onEvent function found on the kyc_config object!",{event:a})},L=function(e,t){var i=t||s,a=i.querySelector(e);return a?a.cloneNode(!0):(console.warn("A templating error has occured.!",{selector:e,template:i.innerHTML}),null)},v={IBAN:function(e){var t,i=String(e).toUpperCase().replace(/[^A-Z0-9]/g,""),a=i.match(/^([A-Z]{2})(\d{2})([A-Z\d]+)$/);return!(!a||i.length!=={AD:24,AE:23,AT:20,AZ:28,BA:20,BE:16,BG:22,BH:22,BR:29,CH:21,CR:21,CY:28,CZ:24,DE:22,DK:18,DO:28,EE:20,ES:24,FI:18,FO:18,FR:27,GB:22,GI:23,GL:18,GR:27,GT:28,HR:21,HU:28,IE:22,IL:23,IS:26,IT:27,JO:30,KW:30,KZ:20,LB:28,LI:21,LT:20,LU:20,LV:21,MC:27,MD:24,ME:22,MK:19,MR:27,MT:31,MU:30,NL:18,NO:15,PK:24,PL:28,PS:29,PT:25,QA:29,RO:24,RS:22,SA:24,SE:24,SI:19,SK:24,SM:27,TN:24,TR:26}[a[1]])&&(t=(a[3]+a[1]+a[2]).replace(/[A-Z]/g,function(e){return((e||"").toString().charCodeAt(0)-55).toString()}),v.mod97(t))},mod97:function(e){for(var t,i=e.slice(0,2),a=2;a<e.length;a+=7)t=String(i)+e.substring(a,a+7),i=parseInt(t,10)%97;return i}},M=function(e){var t=e.target.getAttribute("data-value-format");switch(e.type){case"prefill":switch(t){case"PHONE_NUMBER":e.target.value=(e.target.value||"").replace(/[^0-9\s\+]/g,"").trim().replace(/^00+/g,"+");break;case"IBAN":e.target.value=(e.target.value||"").toUpperCase().replace(/[^A-Z0-9\s]/g,"").trim()}return;case"tokyc":switch(t){case"PHONE_NUMBER":e.target.value=(e.target.value||"").replace(/[\+]/g,"00").replace(/[^0-9]/g,"").trim();break;default:e.target.value=(e.target.value||"").trim()}return e.target.value;case"change":switch(t){case"IBAN":e.target.setCustomValidity(v.IBAN(e.target.value||"")?"Invalid IBAN":"");break;case null:default:e.target.setCustomValidity(e.target.required&&""===(e.target.value||"").trim()?"No empty strings":"")}break;case"input":e.inputType&&"insertFromPaste"==e.inputType&&M({target:e.target,type:"prefill"});break;case"keypress":var i=e.keyCode||e.which,a=String.fromCharCode(i),n=void 0;switch(t){case"PHONE_NUMBER":if(n=["Backspace","ArrowLeft","ArrowRight",8,37,39],/[\s\+]|\./.test(a)&&e.target.value.trim()||!/[0-9\s\+]|\./.test(a)&&n.indexOf(i)<0)return void e.preventDefault();break;case"IBAN":if(n=["Backspace","ArrowLeft","ArrowRight",8,37,39],!/[0-9\-\s\+]|\./.test(a)&&n.indexOf(i)<0)return void e.preventDefault()}}var c=(e.path||[]).filter(function(e){return!!e&&!!e.tagName&&"FORM"===e.tagName}).shift();c&&c.tagName&&x.slice.call(c.querySelectorAll("[data-kyc-task-next]")).map(function(e){e.disabled=!!c&&!c.checkValidity()})},D=function(e){if(e&&e.appendChild){e.innerHTML="";var t=L("[data-kyc-loader]",e.kyc.template);t&&e.appendChild(t),e.setAttribute("kyc-sdk-status","loading")}},h=function(t){if(t)try{var e=L("[data-kyc-dossier-list]",t.kyc.template),i=e.querySelector("[data-kyc-dossier-item]"),a=e.querySelector("[data-kyc-dossier-none]"),n=a.querySelector("kyc-dossier-error");n?n.parentNode.replaceChild(document.createTextNode(_("No dossiers found")),n):a.appendChild(document.createTextNode(_("No dossiers found"))),i.parentNode.removeChild(i),t.innerHTML="",t.appendChild(e),t.setAttribute("kyc-sdk-status","dossiers"),q("dossierlist",t)}catch(e){return void I("A templating error has occured while building the dossier list!","dossierlist",e,{template:t.kyc.template},t)}},U=function(c){if(c&&c.appendChild)try{var e=L("[data-kyc-dossier-list]",c.kyc.template),r=e.querySelector("[data-kyc-dossier-item]"),t=e.querySelector("[data-kyc-dossier-none]"),o=(Array.prototype,r);t.parentNode.removeChild(t),c.kyc.dossiers.map(function(t){var e=r.cloneNode(!0),i=e.querySelector("kyc-dossier-name"),a=e.querySelector("kyc-dossier-status"),n=e.querySelector("kyc-dossier-created");e.setAttribute("data-kyc-status",t.status),i&&i.parentNode.replaceChild(document.createTextNode(t.customerName),i),a&&a.parentNode.replaceChild(document.createTextNode(_(t.status)),a),n&&n.parentNode.replaceChild(document.createTextNode(function(e){if(window.kyc_config&&window.kyc_config.formatDate&&"function"==typeof window.kyc_config.formatDate)return window.kyc_config.formatDate(e)}(new Date(t.createdAt))),n),o.parentNode.insertBefore(e,o.nextSibling),e.addEventListener("click",function(e){D(c),c.kyc.history.back=[],c.kyc.history.next=[],y(t.id,c)}),o=e}),r.parentNode.removeChild(r),c.innerHTML="",c.appendChild(e),c.setAttribute("kyc-sdk-status","dossiers"),q("dossierlist",c)}catch(e){return void I("A templating error has occured while building the dossier list!","dossierlist",e,{template:c.kyc.template},c)}},O=function(n,c){if(n&&n.appendChild)try{var e=L("[data-kyc-task-list]",n.kyc.template),t=e.querySelector("[data-kyc-dossier-title] kyc-text"),r=e.querySelector("[data-kyc-task-item]"),i=e.querySelectorAll("[data-kyc-to-dossiers]"),o=-1<["ACCEPTED","SUBMITTED"].indexOf(c.status)?c.status:null,s=r;t&&t.parentNode.replaceChild(document.createTextNode(c.customerName),t),x.slice.call(i).map(function(e){1<n.kyc.dossiers.length?(x.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(_("Back")),e)}),e.addEventListener("click",function(){U(n)})):e.parentNode.removeChild(e)}),c.tasks.map(function(t){var e=r.cloneNode(!0),i=e.querySelector("kyc-task-name"),a=e.querySelector("kyc-task-status");e.setAttribute("data-kyc-status",o||t.status),i&&i.parentNode.replaceChild(document.createTextNode(t.name),i),a&&a.parentNode.replaceChild(document.createTextNode(_(o||t.status)),a),s.parentNode.insertBefore(e,s.nextSibling),e.addEventListener("click",function(e){D(n),n.kyc.history.back=[],n.kyc.history.next=[],f(t.id,c.id,n)}),s=e}),r.parentNode.removeChild(r),n.innerHTML="",n.appendChild(e),n.setAttribute("kyc-sdk-status","tasks"),q("tasklist",n)}catch(e){return void I("A templating error has occured while building the dossier task list!","tasklist",e,{template:n.kyc.template},n)}},B=function(i,t,a,n){if(i&&i.appendChild)if(-1<["ACCEPTED","SUBMITTED"].indexOf(t.status)?t.status:-1<["ACCEPTED","SUBMITTED"].indexOf(a.status)?a.status:null)!function(t,i,a){if(t&&t.appendChild)try{var e=L("[data-kyc-dossier]",t.kyc.template);x.slice.call(e.querySelectorAll("[name]")).map(function(e){e.removeAttribute("name")});var n,c=e.querySelector("[data-kyc-dossier-title] kyc-text"),r=(e.querySelector(" [data-kyc-dossier-tasks-navigation]"),e.querySelector("[data-kyc-task]")),o=r.querySelector("[data-kyc-task-title] kyc-text"),s=r.querySelector("[data-kyc-check]"),d=r.querySelector("[data-kyc-check-status]").querySelector("kyc-task-status"),l=r.querySelector("[data-kyc-task-overview]"),u=l.querySelector("[data-kyc-task-overview-check]"),k=(r.querySelector("[data-kyc-task-navigation]"),document.createElement("input")),y=(s.querySelector("[data-kyc-input]").cloneNode(!0),-1<["ACCEPTED","SUBMITTED"].indexOf(i.status)?i.status:-1<["ACCEPTED","SUBMITTED"].indexOf(a.status)?a.status:null),f=u;c&&c.parentNode.replaceChild(document.createTextNode(i.customerName),c),o&&o.parentNode.replaceChild(document.createTextNode(a.name),o),d&&d.parentNode.replaceChild(document.createTextNode(_(y||a.status)),d),l&&l.setAttribute("data-kyc-status",y||a.status),r&&r.setAttribute("data-kyc-status",y||a.status),a.checks.map(function(t){if((t.value||"").trim()){var e=u.cloneNode(!0),i=e.querySelector(" data-kyc-check-value");switch(x.slice.call(e.querySelectorAll("kyc-check-description")).map(function(e){t.definition.description?e.parentNode.replaceChild(document.createTextNode(_(t.definition.description)),e):e.parentNode.removeChild(e)}),e.setAttribute("data-kyc-check-value",t.value),t.definition.method&&e.setAttribute("data-kyc-method",t.definition.method||null),t.definition.valueFormat&&e.setAttribute("data-kyc-valueformat",t.definition.valueFormat||null),t.definition.method){case"RAW_DOCUMENT_SCAN":case"DOCUMENT_FILE_UPLOAD":case"SELFIE_CHECK":if(n=document.createTextNode(""),t.value)if(n=document.createElement("img"),A[t.value])n.setAttribute("src",A[t.value]);else{var a={url:w+"/api/v1/uploads/"+t.value,method:"GET",callback:function(e){e.success?(A[t.value]=e.success,n.setAttribute("src",A[t.value])):console.warn("No upload with the id "+t.value+" could be retrieved!",e.error)}};T(a)}break;default:switch(k.value=t.value||null,t.definition.valueFormat){case"NATURAL_NUMBER":case"REAL_NUMBER":k.setAttribute("type","number"),"NATURAL_NUMBER"==t.definition.valueFormat&&(k.setAttribute("step","1"),k.setAttribute("min","0"));break;case"EMAIL":k.setAttribute("type","email");break;case"URL":k.setAttribute("type","url");break;case"PHONE_NUMBER":case"IBAN":k.setAttribute("type","tel");break;default:k.setAttribute("type","text")}M({type:"prefill",target:k}),n=document.createTextNode(k.value)}i.parentNode.replaceChild(n,i),f.parentNode.insertBefore(e,f.nextSibling),f=e}}),s.parentNode.removeChild(s),u.parentNode.removeChild(u),x.slice.call(e.querySelectorAll("[data-kyc-to-dossiers]")).map(function(e){1<t.kyc.dossiers.length?(x.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(_("Back")),e)}),e.addEventListener("click",function(){U(t)})):e.parentNode.removeChild(e)}),x.slice.call(e.querySelectorAll("[data-kyc-to-tasks]")).map(function(e){1<a.checks.length?(x.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(_("Back")),e)}),e.addEventListener("click",function(){O(t,i)})):e.parentNode.removeChild(e)}),x.slice.call(e.querySelectorAll("[data-kyc-task-previous]")).map(function(e){x.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(_("Back")),e)}),e.addEventListener("click",function(){O(t,i)})}),x.slice.call(e.querySelectorAll("[data-kyc-task-next]")).map(function(e){e.parentNode.removeChild(e)}),t.innerHTML="",t.appendChild(e),t.setAttribute("kyc-sdk-status","task"),q("taskoverview",t)}catch(e){return I("A templating error has occured while building the dossier task check overview!","taskoverview",e,{template:t.kyc.template},t)}}(i,t,a);else{n=n||a.sequence.initialCheckId;var c=a.checks.filter(function(e){return e.id==n}).shift();if(c&&c.id){var r=a.sequence.transitions.filter(function(e){return e.from==n}).map(function(e){return e.defaultGoTo}).shift();try{var e=L("[data-kyc-dossier]",i.kyc.template);x.slice.call(e.querySelectorAll("[name]")).map(function(e){e.removeAttribute("name")});var o,s=e.querySelector("[data-kyc-dossier-title] kyc-text"),d=(e.querySelector(" [data-kyc-dossier-tasks-navigation]"),e.querySelector("[data-kyc-task]")),l=d.querySelector("[data-kyc-task-overview]"),u=d.querySelector("[data-kyc-task-title] kyc-text"),k=d.querySelector("[data-kyc-check]"),y=d.querySelector("[data-kyc-check-status]"),f=(d.querySelector("[data-kyc-task-navigation]"),c.id.trim());s&&s.parentNode.replaceChild(document.createTextNode(t.customerName),s),u&&u.parentNode.replaceChild(document.createTextNode(a.name),u),y&&y.parentNode.removeChild(y),l&&l.parentNode.removeChild(l);var p,m=k.cloneNode(!0),v=m.querySelector("kyc-input");switch(x.slice.call(m.querySelectorAll("kyc-check-description")).map(function(e){c.definition.description?e.parentNode.replaceChild(document.createTextNode(_(c.definition.description)),e):e.parentNode.removeChild(e)}),x.slice.call(m.querySelectorAll("kyc-check-longdescription")).map(function(e){c.definition.longDescription?e.parentNode.replaceChild(document.createTextNode(_(c.definition.longDescription)),e):e.parentNode.removeChild(e)}),c.definition.method&&m.setAttribute("data-kyc-method",c.definition.method||null),c.definition.valueFormat&&m.setAttribute("data-kyc-valueformat",c.definition.valueFormat||null),c.definition.method){case"MANUAL_SINGLE_CHOICE_ENUM":case"MANUAL_MULTIPLE_CHOICE_ENUM":switch(o=v.querySelector("[data-kyc-options]").cloneNode(!1),c.definition.method){case"MANUAL_SINGLE_CHOICE_ENUM":if(c.definition.enumSpecification.length<4)(c.definition.enumSpecification||[]).map(function(t){var e=v.querySelector("[data-kyc-radiobutton]").cloneNode(!0),i=e.querySelector("[data-kyc-radio-input]");i.setAttribute("type","radio"),i.setAttribute("name",f),i.setAttribute("value",t.name),i.value=t.name,i.checked=!!c.value&&t.name.trim()===c.value.trim(),x.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(_(t.explanation?t.explanation:t.name)),e)}),p||(p=e),o.appendChild(e)});else{o=v.querySelector("[data-kyc-select-input]").cloneNode(!1);var h=(v.querySelector("[data-kyc-select-input]").querySelector("option")||document.createElement("option")).cloneNode(!1);o.setAttribute("name",f),c.value||(h.value="",h.innerHTML=_("select an option"),o.appendChild(h)),(c.definition.enumSpecification||[]).map(function(e){(h=h.cloneNode(!0)).value=e.name,h.selected=!!c.value&&e.name.trim()===c.value.trim(),h.innerHTML=_(e.explanation?e.explanation:e.name),o.appendChild(h)}),p||(p=o)}break;case"MANUAL_MULTIPLE_CHOICE_ENUM":f=c.id.trim()+"[]",(c.definition.enumSpecification||[]).map(function(t){var e=v.querySelector("[data-kyc-checkbox]").cloneNode(!0),i=e.querySelector("[data-kyc-checkbox-input]");i.setAttribute("type","checkbox"),i.setAttribute("name",f),i.setAttribute("value",t.name),i.checked=!!c.value&&0<JSON.parse(c.value||"[]").filter(function(e){return e.trim()==t.name.trim()}).length,x.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(_(t.explanation?t.explanation:t.name)),e)}),o.appendChild(e),p||(p=e)})}break;default:switch(c.definition.method){case"MANUAL_TEXT_INPUT":case"MANUAL_DATE_INPUT":switch(c.definition.valueFormat){case"LONG_TEXT":(o=v.querySelector("[data-kyc-textarea]").cloneNode(!0)).setAttribute("placeholder",_(c.definition.description)),o.value=c.value||null,o.setAttribute("name",f),o.required=!c.definition.optional,p||(p=o);break;default:switch(o=v.querySelector("[data-kyc-input]").cloneNode(!0),c.definition.valueFormat){case"NATURAL_NUMBER":case"REAL_NUMBER":o.setAttribute("type","number"),"NATURAL_NUMBER"==c.definition.valueFormat&&(o.setAttribute("step",1),o.setAttribute("min",0));break;case"EMAIL":o.setAttribute("type","email");break;case"URL":o.setAttribute("type","url");break;case"PHONE_NUMBER":case"IBAN":o.setAttribute("type","tel");break;default:switch(c.definition.method){case"MANUAL_DATE_INPUT":o.setAttribute("type","date");break;default:o.setAttribute("type","text")}}o.setAttribute("placeholder",_(c.definition.description)),o.setAttribute("name",c.id),c.definition.method&&o.setAttribute("data-method",c.definition.method),c.definition.valueFormat&&o.setAttribute("data-value-format",c.definition.valueFormat),o.required=!c.definition.optional,o.value=c.value||null,p||(p=o),M({type:"prefill",target:o})}["keypress","paste","change","input"].map(function(e){o.addEventListener(e,function(e){return M(e)})});break;case"IDIN":(o=document.createElement("div")).setAttribute("class",v.querySelector("[data-kyc-input]").getAttribute("class")),o.innerHTML="IDIN is coming soon to the web flow";break;case"RAW_DOCUMENT_SCAN":case"DOCUMENT_FILE_UPLOAD":case"SELFIE_CHECK":var g=(o=v.querySelector("[data-kyc-file]").cloneNode(!0)).querySelector("[data-kyc-file-input]"),N=(v.querySelector("kyc-placeholder"),o.querySelector("[data-kyc-file-preview]")),b=document.createElement("input");b.setAttribute("type","hidden"),b.required=!c.definition.optional,b.value=c.value||null,b.setAttribute("name",f),o.appendChild(b),c.definition.method&&b.setAttribute("data-method",c.definition.method),c.definition.valueFormat&&b.setAttribute("data-value-format",c.definition.valueFormat),g.setAttribute("type","file"),g.setAttribute("placeholder",_(c.definition.description)),p||(p=g),N.innerHTML=_(c.definition.description),g.addEventListener("change",function(e){if(e.target.files&&e.target.files[0]){var t=new FileReader;t.onload=function(t){t&&t.target&&t.target.result&&S(t.target.result,i,function(e){e.success&&e.success.uuid&&(A[e.success.uuid]=t&&t.target&&t.target.result?t.target.result:"",N.setAttribute("style",'background-image:url("'+A[e.success.uuid]+'")'))})},N.innerHTML=e.target.files[0].name,t.readAsDataURL(e.target.files[0])}}),c.value&&(A[c.value]?N.setAttribute("style",'background-image:url("'+A[c.value]+'")'):C(c.value,i,function(e){e.success&&(A[c.value]=e.success,N.setAttribute("style",'background-image:url("'+A[c.value]+'")'))}))}}v.parentNode.replaceChild(o,v),k.parentNode.replaceChild(m,k),x.slice.call(e.querySelectorAll("[data-kyc-to-dossiers]")).map(function(e){1<i.kyc.dossiers.length?(x.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(_("Back")),e)}),e.addEventListener("click",function(){U(i)})):e.parentNode.removeChild(e)}),x.slice.call(e.querySelectorAll("[data-kyc-to-tasks]")).map(function(e){1<a.checks.length?(x.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(_("Back")),e)}),e.addEventListener("click",function(){O(i,t)})):e.parentNode.removeChild(e)}),0<i.kyc.history.back.length?x.slice.call(e.querySelectorAll("[data-kyc-task-previous]")).map(function(e){x.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(_("Back")),e)}),e.addEventListener("click",function(){var e,t;(t=(e=i).kyc.history.back.pop())&&(e.kyc.history.next.push(t),"function"==typeof t&&t())})}):x.slice.call(e.querySelectorAll("[data-kyc-task-navigation] [data-kyc-task-previous]")).map(function(e){e.parentNode.removeChild(e)});x.slice.call(e.querySelectorAll("[data-kyc-task-next]")).map(function(e){e.disabled=!!d&&!d.checkValidity(),x.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(_("Next")),e)}),e.addEventListener("click",function(){if(d&&d.checkValidity())return c.value=f==c.id?M({type:"tokyc",target:d.querySelector('[name="'+f+'"]')}):JSON.stringify(x.slice.call(d.querySelectorAll('[name="'+f+'"]')).map(function(e){return M({type:"tokyc",target:e})})),void function(e){if(e)return D(i),i.kyc.history.back.push(function(){D(i),B(i,t,a,c.id)}),B(i,t,a,e);D(i),E(a,i,function(e){e.success&&O(i,t)})}(r)})}),i.innerHTML="",i.appendChild(e),i.setAttribute("kyc-sdk-status","task"),p&&p.focus(),q("taskform",i)}catch(e){I("A templating error has occured while building the dossier task check form!","taskform",e,{template:i.kyc.template,dossier:t,task:a,checkid:n},i)}}else I("The check could not be determined!","taskform",{description:"check is undefined"},{dossier:t,task:a,checkid:n},i)}},g=function(e){return{context:e.kyc.context,status:e.kyc.status}},a=function(e,t){var i,a,n,c,r=document.createElement("kyc-view"),o=p(e,t);return!!o&&(e&&(d=!0),a=o.element,n=o.context,a&&(a.kyc?(a.setAttribute&&a.setAttribute("kyc-sdk-status","ready"),a.kyc.status.reset=new Date,a.kyc.context=n,c=m("reset",g(a))):(i={initialised:new Date,version:l},c=m("initialised",{status:i,context:n}),a.kyc={context:o.context,status:i,template:function(e){s=document.createElement("kyc-template");var t=document.createElement("kyc-custom-template"),i=document.createElement("kyc-default-template");return i.innerHTML='/*\x3c!-- Define the template for the dossier-list --\x3e<ul data-kyc-dossier-list><li data-kyc-dossier-none><span><kyc-dossier-error></kyc-dossier-error></span></li><li data-kyc-dossier-item><span><kyc-dossier-name></kyc-dossier-name></span><span><kyc-dossier-status></kyc-dossier-status></span><span><kyc-dossier-created></kyc-dossier-created></span></li></ul>\x3c!-- Define the template for the task-list in a dossier--\x3e<div data-kyc-task-list><h1 data-kyc-dossier-title><button data-kyc-to-dossiers></button><kyc-text></kyc-text></h1><ul><li data-kyc-task-item><span><kyc-task-name></kyc-task-name></span><span><kyc-task-status></kyc-task-status></span></li></ul></div>\x3c!-- Define the template for a single dossier --\x3e<div data-kyc-dossier><h1 data-kyc-dossier-title><button data-kyc-to-dossiers></button><kyc-text></kyc-text></h1>\x3c!-- Define the template for a single task in a dossier --\x3e<form data-kyc-task><h2 data-kyc-task-title><button data-kyc-to-tasks></button><kyc-text></kyc-text></h2>\x3c!-- Define the template for a single check in a task in a dossier --\x3e<div data-kyc-check><label><kyc-check-description></kyc-check-description></label><kyc-input><input data-kyc-input> <textarea data-kyc-textarea></textarea> <select data-kyc-select-input></select><div data-kyc-options><div data-kyc-checkbox><label><input type="checkbox" data-kyc-checkbox-input><kyc-text></kyc-text></label></div><div data-kyc-radiobutton><label><input type="radio" data-kyc-radio-input><kyc-text></kyc-text></label></div></div><div data-kyc-file><input type="file" class="form-control" data-kyc-file-input><div class="filepreview" data-kyc-file-preview></div></div></kyc-input><small><kyc-check-longdescription></kyc-check-longdescription></small></div>\x3c!-- Define the template for the check overview in a task in a dossier --\x3e<div data-kyc-check-overview><label><kyc-check-description></kyc-check-description></label><p><data-kyc-check-value></data-kyc-check-value></p></div>\x3c!-- Define the template the navigation between tasks in a dossier --\x3e<div data-kyc-task-navigation><button data-kyc-task-previous><kyc-text></kyc-text></button> <button data-kyc-task-next><kyc-text></kyc-text></button></div></form></div>\x3c!-- Define the template the loader --\x3e<div data-kyc-loader></div>*/',t.innerHTML=e,s.appendChild(t),s.appendChild(i),s.cloneNode(!0)}(a.innerHTML.trim()),history:{back:[],next:[]}},a.setAttribute&&(a.setAttribute("kyc-sdk-status","ready"),D(a),a.appendChild(r)))),q(c,a),u(a),a)};if(!window[t]){window[t]={get initialised(){return i},get version(){return l},init:a,getToken:function(){return u()},getMe:function(){if(c)return o();I("no valid Identification","getDossiers",{description:"missing KYCToken"})},getDossiers:function(){if(c)return k();I("no valid Identification","getDossiers",{description:"missing KYCToken"})},getTasks:function(e){if(c)return y(e);I("no valid Identification","getTasks",{description:"missing KYCToken"})},getTask:function(e){if(c)return f(e);I("no valid Identification"," getTask",{description:"missing KYCToken"})},getUpload:function(e){if(c)return C(e);I("no valid Identification"," getTask",{description:"missing KYCToken"})},saveUpload:function(e){if(c)return S(e);I("no valid Identification"," getTask",{description:"missing KYCToken"})},saveTask:function(e){if(c)return E(e);I("no valid Identification","saveTask",{description:"missing KYCToken"})}};var N=m("ready",{status:{initialised:i,version:l}});q(N,window),e=function(){p()&&a()},"loading"!=document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"loading"!=document.readyState&&e()})}}();