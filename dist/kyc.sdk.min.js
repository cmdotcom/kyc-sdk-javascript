"use strict";!function(){window.console&&"undefined"!=typeof console||(console=console||{},["assert","clear","count","error","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","trace","warn"].map(function(e){console[e]=function(){}}));var s,c,N,a,e,l=!1,t="kyc_sdk",d="0.0.1",w={},n=new Date,o=function(t){t&&"string"==typeof t&&(t={url:t.trim()}),t.method=t.method||"GET";var n,c=function(e){t.callback&&"function"==typeof t.callback&&t.callback(e)},a=new XMLHttpRequest,e=t.params;try{a.open(t.method,t.url)}catch(e){return void c({error:e,xhr:a})}if(a.withCredentials=t.withCredentials||!1,a.addEventListener("load",function(){if(console.log(a),4==a.readyState)if(200<=a.status&&a.status<300){try{n=JSON.parse(a.response||a.responseText)}catch(e){n=a.response||a.responseText}c({success:n,xhr:a})}else c({error:"invalid http status",xhr:a})}),a.addEventListener("error",function(){c({error:"invalid http status",xhr:a})}),t.headers)for(var o in t.headers)a.setRequestHeader(o,t.headers[o]);if("GET"==t.method&&t.params&&"object"==typeof t.params){for(var o in e=[],t.params)e.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));e=e.join("&")}try{a.send(e)}catch(e){c({error:e,xhr:a})}},x=function(e){e.headers={Authorization:"Bearer "+a.userToken},o(e)},u=function(n){if(a&&a.userToken)i(n);else{var e={url:c,method:"POST",withCredentials:!0,headers:{"Content-Type":"application/json;charset=UTF-8"},params:JSON.stringify({clientId:n.kyc.context.clientId,templateId:n.kyc.context.templateId,customerName:n.kyc.context.customerName,externalReference:n.kyc.context.externalReference,firstName:n.kyc.context.firstName,lastName:n.kyc.context.lastName,msisdn:n.kyc.context.msisdn,userIdentifier:n.kyc.context.userIdentifier}),callback:function(e){if(e.success)p("login",n),(a=e.success).data=function(e){try{var t=e.split(".")[0].replace("-","+").replace("_","/"),n=JSON.parse(window.atob(t)),c=e.split(".")[1].replace("-","+").replace("_","/"),a=JSON.parse(window.atob(c));return a.header=n,a}catch(e){return!1}}(a.userToken),i(n);else{var t="No kyc Token could be retrieved from "+c+"!";p("error",n,{error:{message:t,object:e}}),console.warn(t,e)}}};o(e)}},i=function(t){x({url:N+"/api/v1/users/me",callback:function(e){if(e.success)t.kyc.status.changed=new Date,t.kyc.context.firstName=e.success.firstName,t.kyc.context.lastName=e.success.lastName,t.kyc.context.msisdn=e.success.msisdn,p("identification",t),r(t);else{p("error",t,{error:{message:"KYC identity could not be verified!",object:e}}),console.warn("KYC identity could not be verified!",e.error)}}})},r=function(t){var e={url:N+"/api/v1/users/"+a.data.uuid+"/dossiers",callback:function(e){e.success?(t.kyc.status.changed=new Date,t.kyc.dossiers=((e.success.filter(function(e){return!0})||[]).map(function(e){return e.dossiers}).shift()||[]).filter(function(e){return!0}),p("dossiers",t),0<t.kyc.dossiers.length&&E(t)):console.warn("KYC dossiers could not be fetched!",e.error)}};x(e)},y=function(e,t){if(!window.kyc_config)return l&&console.warn("No kyc_config object found on window!"),!1;if(!window.kyc_config.authorisationEndPoint)return l&&console.warn("No kyc authorisationEndPoint on the kyc_config object!"),!1;if(!window.kyc_config.kycApiEndPoint)return l&&console.warn("No kyc kycApiEndPoint on the kyc_config object!"),!1;if(c=window.kyc_config.authorisationEndPoint,N=window.kyc_config.kycApiEndPoint,!t){if(!window.kyc_config.context)return l&&console.warn("No context object found on the kyc_config object!"),!1;t=window.kyc_config.context}if(!e){if(!window.kyc_config.elementId)return l&&console.warn("No elementId object found on the kyc_config object!"),!1;e=window.kyc_config.elementId}return e?document.getElementById(e)?{element:document.getElementById(e),context:JSON.parse(JSON.stringify(t))}:e?void 0:(l&&console.warn("The HTML element with id '"+e+"'  is not present in the DOM tree!"),!1):(l&&console.warn("No elementId is given!"),!1)},k=function(e,t){var n;return"function"==typeof Event?n=new Event(e):(n=document.createEvent("Event")).initEvent(e,!0,!0),t&&(n.detail=t),n},g=function(e){return e=e||"",window.kyc_config&&window.kyc_config.translate&&"function"==typeof window.kyc_config.translate?window.kyc_config.translate(e):e},p=function(t,e,n){var c;t&&"string"==typeof t&&e&&e.kyc&&(t=k(t.trim(),n||f(e)));try{c=JSON.parse(JSON.stringify(t))}catch(e){return void console.log(e,t,typeof t)}c.isTrusted=!0,c.type=t.type.toString(),e?function(e,t){if(e!=window&&(e.kyc.eventType=t),"createEvent"in document){var n=document.createEvent("HTMLEvents");return n.initEvent("load",!1,!0),n.kyctype=t,e.dispatchEvent(n)}e.fireEvent("onload")}(c.target=e,c.type):c.target="kyc_sdk",window.kyc_config&&window.kyc_config.onEvent&&"function"==typeof window.kyc_config.onEvent?window.kyc_config.onEvent(c):l&&console.warn("No onEvent function found on the kyc_config object!",{event:c})},A=function(e,t){var n=t||s,c=n.querySelector(e);return c?c.cloneNode(!0):(console.warn("A templating error has occured.!",{selector:e,template:n.innerHTML}),null)},S=function(e){e.innerHTML="";var t=A("[data-kyc-loader]",e.kyc.template);t&&e.appendChild(t),e.setAttribute("kyc-sdk-status","loading")},E=function(o){try{var e=A("[data-kyc-dossier-list]",o.kyc.template),i=e.querySelector("[data-kyc-dossier-item]"),r=(Array.prototype,i);o.kyc.dossiers.map(function(t){var e=i.cloneNode(!0),n=e.querySelector("kyc-dossier-name"),c=e.querySelector("kyc-dossier-status"),a=e.querySelector("kyc-dossier-created");e.setAttribute("data-kyc-status",t.status),n&&n.parentNode.replaceChild(document.createTextNode(t.customerName),n),c&&c.parentNode.replaceChild(document.createTextNode(g(t.status)),c),a&&a.parentNode.replaceChild(document.createTextNode(function(e){if(window.kyc_config&&window.kyc_config.formatDate&&"function"==typeof window.kyc_config.formatDate)return window.kyc_config.formatDate(e)}(new Date(t.createdAt))),a),r.parentNode.insertBefore(e,r.nextSibling),e.addEventListener("click",function(e){S(o),o.kyc.history.back=[],o.kyc.history.next=[],function(t,n){var c=t.kyc.dossiers.filter(function(e){return e.id==n}).shift();if(c)return c.tasks?C(t,c):x({url:N+"/api/v1/dossiers/"+n+"/tasks",callback:function(e){e.success?(c.tasks=e.success,C(t,c)):console.warn("KYC dossier tasks could not be fetched!",e.error)}});console.warn("KYC dossier could not be fetched!")}(o,t.id)}),r=e}),i.parentNode.removeChild(i),o.innerHTML="",o.appendChild(e),o.setAttribute("kyc-sdk-status","dossiers")}catch(e){return void console.warn("A templating error has occured while building the dossier list!",e)}},C=function(a,o){try{var e=A("[data-kyc-task-list]",a.kyc.template),t=e.querySelector("[data-kyc-dossier-title] kyc-text"),i=e.querySelector("[data-kyc-task-item]"),n=e.querySelector("[data-kyc-to-dossiers]"),c=Array.prototype,r=i;t&&t.parentNode.replaceChild(document.createTextNode(o.customerName),t),c.slice.call(n.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g("Back")),e)}),n.addEventListener("click",function(){E(a)}),o.tasks.map(function(t){var e=i.cloneNode(!0),n=e.querySelector("kyc-task-name"),c=e.querySelector("kyc-task-status");e.setAttribute("data-kyc-status",t.status),n&&n.parentNode.replaceChild(document.createTextNode(t.name),n),c&&c.parentNode.replaceChild(document.createTextNode(g(t.status)),c),r.parentNode.insertBefore(e,r.nextSibling),e.addEventListener("click",function(e){S(a),a.kyc.history.back=[],a.kyc.history.next=[],function(t,n,c){var a,o;if((a=t.kyc.dossiers.filter(function(e){return e.id==n}).map(function(e){return e}).shift())&&a.tasks&&(o=a.tasks.filter(function(e){return e.id==c}).shift()))return o.checks?T(t,a,o):x({url:N+"/api/v1/tasks/"+c,callback:function(e){e.success?(o=e.success,setTimeout(function(){T(t,a,o)},1e3)):console.warn("KYC dossier tasks could not be fetched!",e.error)}});console.warn("KYC dossier could not be fetched!")}(a,o.id,t.id)}),r=e}),i.parentNode.removeChild(i),a.innerHTML="",a.appendChild(e),a.setAttribute("kyc-sdk-status","tasks")}catch(e){return void console.warn("A templating error has occured while building the dossier task list!",e)}},T=function(n,t,c,a){a=a||c.sequence.initialCheckId;var o=c.checks.filter(function(e){return e.id==a}).shift();if(o&&o.id){var i=c.sequence.transitions.filter(function(e){return e.from==a}).map(function(e){return e.defaultGoTo}).shift();try{var e=A("[data-kyc-dossier]",n.kyc.template),r=Array.prototype;r.slice.call(e.querySelectorAll("[name]")).map(function(e){e.removeAttribute("name")});var s,l=e.querySelector("[data-kyc-dossier-title] kyc-text"),d=(e.querySelector(" [data-kyc-dossier-tasks-navigation]"),e.querySelector("[data-kyc-task]")),u=d.querySelector("[data-kyc-task-title] kyc-text"),y=d.querySelector("[data-kyc-check]"),k=(d.querySelector("[data-kyc-task-navigation]"),o.id.trim());l&&l.parentNode.replaceChild(document.createTextNode(t.customerName),l),u&&u.parentNode.replaceChild(document.createTextNode(c.name),u);var p=y.cloneNode(!0),f=p.querySelector("kyc-input");switch(r.slice.call(p.querySelectorAll("kyc-check-description")).map(function(e){o.definition.description?e.parentNode.replaceChild(document.createTextNode(g(o.definition.description)),e):e.parentNode.removeChild(e)}),r.slice.call(p.querySelectorAll("kyc-check-longdescription")).map(function(e){o.definition.longDescription?e.parentNode.replaceChild(document.createTextNode(g(o.definition.longDescription)),e):e.parentNode.removeChild(e)}),o.definition.method&&p.setAttribute("data-kyc-method",o.definition.method||null),o.definition.valueFormat&&p.setAttribute("data-kyc-valueformat",o.definition.valueFormat||null),o.definition.method){case"MANUAL_SINGLE_CHOICE_ENUM":case"MANUAL_MULTIPLE_CHOICE_ENUM":switch(s=f.querySelector("[data-kyc-options]").cloneNode(!1),o.definition.method){case"MANUAL_SINGLE_CHOICE_ENUM":if(o.definition.enumSpecification.length<4)(o.definition.enumSpecification||[]).map(function(t){var e=f.querySelector("[data-kyc-radiobutton]").cloneNode(!0),n=e.querySelector("[data-kyc-radio-input]");n.setAttribute("type","radio"),n.setAttribute("name",k),n.setAttribute("value",t.name),n.value=t.name,n.checked=!!o.value&&t.name.trim()===o.value.trim(),r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g(t.explanation?t.explanation:t.name)),e)}),s.appendChild(e)});else{s=f.querySelector("[data-kyc-select-input]").cloneNode(!1);var m=(f.querySelector("[data-kyc-select-input]").querySelector("option")||document.createElement("option")).cloneNode(!1);s.setAttribute("name",k),o.value||(m.value="",m.innerHTML=g("select an option"),s.appendChild(m)),(o.definition.enumSpecification||[]).map(function(e){(m=m.cloneNode(!0)).value=e.name,m.selected=!!o.value&&e.name.trim()===o.value.trim(),m.innerHTML=g(e.explanation?e.explanation:e.name),s.appendChild(m)})}break;case"MANUAL_MULTIPLE_CHOICE_ENUM":k=o.id.trim()+"[]",(o.definition.enumSpecification||[]).map(function(t){var e=f.querySelector("[data-kyc-checkbox]").cloneNode(!0),n=e.querySelector("[data-kyc-checkbox-input]");n.setAttribute("type","checkbox"),n.setAttribute("name",k),n.setAttribute("value",t.name),n.checked=!!o.value&&0<JSON.parse(o.value||"[]").filter(function(e){return e.trim()==t.name.trim()}).length,r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g(t.explanation?t.explanation:t.name)),e)}),s.appendChild(e)})}break;default:switch(o.definition.method){case"MANUAL_TEXT_INPUT":case"MANUAL_DATE_INPUT":switch(o.definition.valueFormat){case"LONG_TEXT":(s=f.querySelector("[data-kyc-textarea]").cloneNode(!0)).setAttribute("placeholder",g(o.definition.description)),s.value=o.value||null,s.setAttribute("name",k);break;default:switch(s=f.querySelector("[data-kyc-input]").cloneNode(!0),o.definition.valueFormat){case"NATURAL_NUMBER":case"REAL_NUMBER":s.setAttribute("type","number"),"NATURAL_NUMBER"==o.definition.valueFormat&&(s.setAttribute("step",1),s.setAttribute("min",0));break;case"EMAIL":s.setAttribute("type","email");break;case"URL":s.setAttribute("type","url");break;case"PHONE_NUMBER":case"IBAN":s.setAttribute("type","tel");break;default:s.setAttribute("type","text")}s.setAttribute("placeholder",g(o.definition.description)),s.setAttribute("name",o.id),s.value=o.value||null}break;case"IDIN":(s=document.createElement("div")).setAttribute("class",f.querySelector("[data-kyc-input]").getAttribute("class")),s.innerHTML="IDIN is coming soon to the web flow";break;case"RAW_DOCUMENT_SCAN":case"DOCUMENT_FILE_UPLOAD":case"SELFIE_CHECK":var h=(s=f.querySelector("[data-kyc-file]").cloneNode(!0)).querySelector("[data-kyc-file-input]"),v=(f.querySelector("kyc-placeholder"),s.querySelector("[data-kyc-file-preview]"));if(h.setAttribute("type","file"),h.setAttribute("placeholder",g(o.definition.description)),v.innerHTML=g(o.definition.description),h.addEventListener("change",function(e){if(e.target.files&&e.target.files[0]){var t=new FileReader;t.onload=function(e){console.log(e)},t.readAsDataURL(e.target.files[0])}console.log(e)}),o.value)if(w[o.value])v.setAttribute("style",'background-image:url("'+w[o.value]+'")');else{var b={url:N+"/api/v1/uploads/"+o.value,method:"POST",callback:function(e){e.success?(w[o.value]=e.success,v.setAttribute("style",'background-image:url("'+w[o.value]+'")')):console.warn("No upload with the id "+o.value+" could be retrieved!",e.error)}};x(b)}}}f.parentNode.replaceChild(s,f),y.parentNode.replaceChild(p,y),r.slice.call(e.querySelectorAll("[data-kyc-to-dossiers]")).map(function(e){r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g("Back")),e)}),e.addEventListener("click",function(){E(n)})}),r.slice.call(e.querySelectorAll("[data-kyc-to-tasks]")).map(function(e){r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g("Back")),e)}),e.addEventListener("click",function(){C(n,t)})}),0<n.kyc.history.back.length?r.slice.call(e.querySelectorAll("[data-kyc-task-previous]")).map(function(e){r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g("Back")),e)}),e.addEventListener("click",function(){var e,t;(t=(e=n).kyc.history.back.pop())&&(e.kyc.history.next.push(t),"function"==typeof t&&t())})}):r.slice.call(e.querySelectorAll("[data-kyc-task-navigation] [data-kyc-task-previous]")).map(function(e){e.parentNode.removeChild(e)}),r.slice.call(e.querySelectorAll("[data-kyc-task-next]")).map(function(e){r.slice.call(e.querySelectorAll("kyc-text")).map(function(e){e.parentNode.replaceChild(document.createTextNode(g("Next")),e)}),e.addEventListener("click",function(){var e=n.querySelector("form");if(e&&(o.value=k==o.id?(e.querySelector('[name="'+k+'"]')||{value:""}).value||"":JSON.stringify(r.slice.call(e.querySelectorAll('[name="'+k+'"]')).map(function(e){return e.value||""}))),i)return S(n),n.kyc.history.back.push(function(){S(n),T(n,t,c,o.id)}),void T(n,t,c,i);S(n),n.kyc.history.back.push(function(){S(n),T(n,t,c,o.id)}),C(n,t)})}),n.innerHTML="",n.appendChild(e),n.setAttribute("kyc-sdk-status","task")}catch(e){console.warn("A templating error has occured while building the dossier task check form!",e)}}else console.warn("The check could not be determined!")},f=function(e){return{context:e.kyc.context,status:e.kyc.status}},m=function(e,t){var n,c,a,o,i=document.createElement("kyc-view"),r=y(e,t);return!!r&&(l=!0,c=r.element,a=r.context,c.kyc?(c.setAttribute("kyc-sdk-status","ready"),c.kyc.status.reset=new Date,c.kyc.context=a,o=k("reset",f(c))):(n={initialised:new Date,version:d},o=k("initialised",{status:n,context:a}),c.kyc={context:r.context,status:n,template:function(e){s=document.createElement("kyc-template");var t=document.createElement("kyc-custom-template"),n=document.createElement("kyc-default-template");return n.innerHTML='/*\x3c!-- Define the template for the dossier-list --\x3e<ul data-kyc-dossier-list><li data-kyc-dossier-item><span><kyc-dossier-name></kyc-dossier-name></span><span><kyc-dossier-status></kyc-dossier-status></span><span><kyc-dossier-created></kyc-dossier-created></span></li></ul><div data-kyc-task-list><h1 data-kyc-dossier-title><button data-kyc-to-dossiers></button><kyc-text></kyc-text></h1><ul><li data-kyc-task-item><span><kyc-task-name></kyc-task-name></span><span><kyc-task-status></kyc-task-status></span></li></ul></div>\x3c!-- Define the template for a single dossier --\x3e<div data-kyc-dossier><h1 data-kyc-dossier-title><button data-kyc-to-dossiers></button><kyc-text></kyc-text></h1><div data-kyc-dossier-tasks-navigation></div>\x3c!-- Define the template for a single task in a dossier --\x3e<form data-kyc-task><h2 data-kyc-task-title><button data-kyc-to-tasks></button><kyc-text></kyc-text></h2>\x3c!-- Define the template for a single check in a task in a dossier --\x3e<div data-kyc-check><label><kyc-check-description></kyc-check-description></label><kyc-input><input data-kyc-input class="form-control"> <textarea data-kyc-textarea class="form-control"></textarea> <select class="form-control" data-kyc-select-input></select><div data-kyc-options class="form-control form-options row"><div data-kyc-checkbox class="col-12 col-md-4 form-check"><label class="multiline"><input type="checkbox" data-kyc-checkbox-input> <span class="label"><span class="multiline"><kyc-text></kyc-text></span></span></label></div><div data-kyc-radiobutton class="col-12 col-md-4 form-radio"><label class="multiline"><input type="radio" data-kyc-radio-input> <span class="label"><span class="multiline"><kyc-text></kyc-text></span></span></label></div></div><div data-kyc-file class="form-control file-input cursor-pointer"><input type="file" class="form-control" data-kyc-file-input><div class="filepreview" data-kyc-file-preview></div></div></kyc-input><small><kyc-check-longdescription></kyc-check-longdescription></small></div>\x3c!-- Define the template the navigation between tasks in a dossier --\x3e<div data-kyc-task-navigation><button data-kyc-task-previous><kyc-text></kyc-text></button> <button data-kyc-task-next><kyc-text></kyc-text></button></div></form></div>\x3c!-- Define the template the loader --\x3e<div data-kyc-loader></div>*/',t.innerHTML=e,s.appendChild(t),s.appendChild(n),s.cloneNode(!0)}(c.innerHTML.trim()),history:{back:[],next:[]}},c.setAttribute("kyc-sdk-status","ready"),S(c),c.appendChild(i)),p(o,c),u(c),c)};if(!window[t]){window[t]={get initialised(){return n},get version(){return d},init:m};var h=k("ready",{status:{initialised:n,version:d}});p(h,window),l=!0,e=function(){y()&&m()},"loading"!=document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"loading"!=document.readyState&&e()})}}();